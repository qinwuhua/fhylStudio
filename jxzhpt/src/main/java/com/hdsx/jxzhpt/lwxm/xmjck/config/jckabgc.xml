<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.jckabgc">
	<insert id="insertJckabgc" parameterType="jckabgc">
		insert into
		xmk_abgc(id,lxbm,lxmc,gydw,gydwbm,qdzh,zdzh,qzlc,xzqhdm,xzqhmc,gjxjnd,lxjsdj,yhlc,xmnf,xmtype,yhnr,bz,tbbmbm,tbsj,sbzt,shzt,sbthcd,tsdq<if test="xmklx != null">,xmklx</if>)
		values(sys_guid(),#{lxbm},#{lxmc},#{gydw},#{gydwbm},#{qdzh},#{zdzh},#{qzlc},#{xzqhdm},#{xzqhmc},#{gjxjnd},#{lxjsdj},#{yhlc},#{xmnf},
		#{xmtype},#{yhnr},#{bz},#{tbbmbm},sysdate,'未上报','未审核',#{sbthcd},#{tsdq}<if test="xmklx != null">,#{xmklx}</if>)
	</insert>

	<select id="selectJckabgc" parameterType="jckabgc" resultType="jckabgc">
		select * from (
		select rownum num ,t.*,decode(sbthcd,#{sbthcd},'未上报',sbzt) sbzt2  from xmk_abgc t where 1=1
			and  sbthcd &lt;=#{sbthcd}
		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
		<if test="lxmc!='' and lxmc!= null ">
			and lxmc like '%'||(#{lxmc})||'%'
		</if>
		<if test="xmnf!='' and xmnf!= null ">
			and xmnf in (${xmnf})
		</if>
		<if test="xmtype!='' and xmtype!= null ">
			and xmtype like '%'||(#{xmtype})||'%'
		</if>
		<if test="sbzt!='' and sbzt!= null ">
			and decode(sbthcd,#{sbthcd},'未上报',sbzt) like '%'||(#{sbzt})||'%'
		</if>
		<if test="jsdj!='' and jsdj!= null ">
			${jsdj}
		</if>
		<if test="lxbm!='' and lxbm!= null ">
			and lxbm like #{lxbm}||'%'
		</if>
		<if test="gldj !='' and gldj != null ">
 			${gldj}
 		</if>
 		<if test="tsdq!='' and tsdq!= null ">
 			${tsdq}
 		</if>
 		<if test="xmklx !='' and xmklx != null ">
 			and xmklx like '%'||(#{xmklx})||'%'
 		</if>
		) t1 where t1.num &lt;=(#{page} * #{rows}) and t1.num>(#{page}-1)*#{rows}
		order by decode(sbthcd,#{sbthcd},'未上报',sbzt),shzt desc
	</select>
	<select id="selectAbgcCount" parameterType="jckabgc" resultType="int">
		select count(*) from xmk_abgc where 1=1
			and  sbthcd &lt;=#{sbthcd}
		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
		<if test="lxmc!='' and lxmc!= null ">
			and lxmc like '%'||(#{lxmc})||'%'
		</if>
		<if test="xmnf!='' and xmnf!= null ">
			and xmnf in (${xmnf})
		</if>
		<if test="xmtype!='' and xmtype!= null ">
			and xmtype like '%'||(#{xmtype})||'%'
		</if>
		<if test="sbzt!='' and sbzt!= null ">
			and decode(sbthcd,#{sbthcd},'未上报',sbzt) like '%'||(#{sbzt})||'%'
		</if>
		<if test="jsdj!='' and jsdj!= null ">
			${jsdj}
		</if>
		<if test="lxbm!='' and lxbm!= null ">
			and lxbm like #{lxbm}||'%'
		</if>
		<if test="gldj !='' and gldj != null ">
 			${gldj}
 		</if>
 		<if test="tsdq!='' and tsdq!= null ">
 			${tsdq}
 		</if>
 		<if test="xmklx !='' and xmklx != null ">
 			and xmklx like '%'||(#{xmklx})||'%'
 		</if>
	</select>
	<select id="selectJckabgcById" parameterType="jckabgc"
		resultType="jckabgc">
		select * from xmk_abgc where id=#{id}
	</select>
	<update id="updateJckabgc" parameterType="jckabgc">
		update xmk_abgc set
		lxbm=#{lxbm},lxmc=#{lxmc},gydw=#{gydw},qdzh=#{qdzh},zdzh=#{zdzh},qzlc=#{qzlc},xzqhdm=#{xzqhdm},
		xzqhmc=#{xzqhmc},gjxjnd=#{gjxjnd},lxjsdj=#{lxjsdj},yhlc=#{yhlc},xmnf=#{xmnf},xmtype=#{xmtype},
		yhnr=#{yhnr},bz=#{bz}
		<if test="xmklx != null">
			,xmklx=#{xmklx}
		</if>
		 where id=#{id}
	</update>

	<select id="selectGpsroad" parameterType="hashmap" resultType="jckabgc">
		select roadcode lxbm,roadname lxmc,min(roadstart) qdzh,max(roadends)
		zdzh,(max(roadends)-min(roadstart)) qzlc,
		substr(roadcode,length(roadcode)-5,6) xzqhdm, 
		(select name from xtgl_xzqh where id=substr(roadcode,length(roadcode)-5,6))
		xzqhmc,F044 gydwbm,F045 gydw,
		decode(max(substr(F026, 0, 4)), null, max(substr(F025,0,4)), max(substr(F026, 0, 4)))
		gjxjnd,F114 lxjsdj from GPSROAD
		where substr(roadcode,1,1) in('G','S','X','Y') and F048='1' and roadcode like #{lxbm} ||'%' 
		<if test="gydwbm!='' and gydwbm!= null ">
			and F044 in(select id from xtgl_department where id like '%'||substr(#{gydwbm},0,4)||'_'||substr(#{gydwbm},6)||'%' or parent like '%'||substr(#{gydwbm},0,4)||'_'||substr(#{gydwbm},6)||'%') 
		</if>
<!-- 		<if test="xzqhdm!='' and xzqhdm!= null ">
			and substr(roadcode,length(roadcode)-5,6) in(select id from xtgl_xzqh where id=#{xzqhdm} or parent=#{xzqhdm}) 
		</if> -->
 		and<![CDATA[ROWNUM <=50]]>
		group by roadname,roadcode,F114,F044,F045
		order by roadcode,min(roadstart)
	</select>
	<select id="selectJckRoad" parameterType="hashmap" resultType="jckabgc">
		select
		id,lxbm,lxmc,gydw,qdzh,zdzh,qzlc,xzqhdm,xzqhmc,gjxjnd,lxjsdj,yhlc,xmnf,xmtype,yhnr,bz,tsdq
		from xmk_abgc where shzt='已审核' and lxbm like #{lxbm}||'%'
		<if test="gydwbm!='' and gydwbm!= null ">
			and tbbmbm in(select id from xtgl_department where id like '%'||substr(#{gydwbm},0,4)||'_'||substr(#{gydwbm},6)||'%' or parent like '%'||substr(#{gydwbm},0,4)||'_'||substr(#{gydwbm},6)||'%') 
		</if>
		order by lxbm
	</select>

	<delete id="deleteJckAbgc" parameterType="java.util.List">
		delete from xmk_abgc where id =#{String}
	</delete>
	<update id="xgJckAbgcSbzt" parameterType="hashmap">
		update xmk_abgc set sbzt='已上报',sbsj=sysdate,sbbm=#{sbbm},sbthcd=#{sbthcd} where id =#{id}
	</update>
	<update id="xgJckAbgcShzt" parameterType="hashmap">
		update xmk_abgc set shzt='已审核', shsj=sysdate,shbm=#{shbm} where id=#{id}
	</update>
	<update id="xgShzt2" parameterType="hashmap">
		update ${xmlx} set shzt='未审核', shsj=null,shbm='' where id=#{id}
	</update>
	<update id="xgShztwqjck" parameterType="hashmap">
		update ${xmlx} set zgshzt='未审核', shsj=null,shbm='' where id=#{id}
	</update>
	
	<update id="xgJckAbgcTH" parameterType="java.util.List">
		update xmk_abgc set sbthcd=(sbthcd+2) where id =#{String}
	</update>

	<select id="selectJckShabgc" parameterType="jckabgc" resultType="jckabgc">
		select * from (
		select rownum num ,t.* from xmk_abgc t where sbthcd=7
			and sbthcd>=#{sbthcd}
		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
		<if test="lxmc!='' and lxmc!= null ">
			and lxmc like '%'||(#{lxmc})||'%'
		</if>
		<if test="xmnf!='' and xmnf!= null ">
			and xmnf in (${xmnf})
		</if>
		<if test="xmtype!='' and xmtype!= null ">
			and xmtype like '%'||(#{xmtype})||'%'
		</if>
		<if test="shzt!='' and shzt!= null ">
			and shzt like '%'||(#{shzt})||'%'
		</if>
		<if test="jsdj!='' and jsdj!= null ">
			${jsdj}
		</if>
		<if test="gldj!='' and gldj!= null ">
			${gldj}
		</if>
		<if test="lxbm!='' and lxbm!= null ">
			and lxbm like #{lxbm}||'%'
		</if>
		<if test="bz!='' and bz!= null ">
 			and lxbm like #{bz}||'%'
 		</if>
 		<if test="tsdq!='' and tsdq!= null ">
 			${tsdq}
 		</if>
 		<if test="xmklx !='' and xmklx != null ">
 			and xmklx like '%'||(#{xmklx})||'%'
 		</if>
		) t1 where t1.num &lt;=(#{page} * #{rows}) and
		t1.num>(#{page}-1)*#{rows}
		order by shzt desc
	</select>
	<select id="selectAbgcShCount" parameterType="jckabgc"
		resultType="int">
		select count(*) from xmk_abgc where sbthcd=7
			and sbthcd>=#{sbthcd}
		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
		<if test="lxmc!='' and lxmc!= null ">
			and lxmc like '%'||(#{lxmc})||'%'
		</if>
		<if test="xmnf!='' and xmnf!= null ">
			and xmnf in (${xmnf})
		</if>
		<if test="xmtype!='' and xmtype!= null ">
			and xmtype like '%'||(#{xmtype})||'%'
		</if>
		<if test="shzt!='' and shzt!= null ">
			and shzt like '%'||(#{shzt})||'%'
		</if>
		<if test="jsdj!='' and jsdj!= null ">
			${jsdj}
		</if>
		<if test="gldj!='' and gldj!= null ">
			${gldj}
		</if>
		<if test="lxbm!='' and lxbm!= null ">
			and lxbm like #{lxbm}||'%'
		</if>
		<if test="bz!='' and bz!= null ">
 			and lxbm like #{bz}||'%'
 		</if>
 		<if test="tsdq!='' and tsdq!= null ">
 			${tsdq}
 		</if>
 		<if test="xmklx !='' and xmklx != null ">
 			and xmklx like '%'||(#{xmklx})||'%'
 		</if>
	</select>
	<sql id="abgc_commonsql">
		and  sbthcd &lt;=#{sbthcd}
		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
		<if test="lxmc!='' and lxmc!= null ">
			and lxmc like '%'||(#{lxmc})||'%'
		</if>
		<if test="xmnf!='' and xmnf!= null ">
			and xmnf like '%'||(#{xmnf})||'%'
		</if>
		<if test="xmtype!='' and xmtype!= null ">
			and xmtype like '%'||(#{xmtype})||'%'
		</if>
		<if test="sbzt!='' and sbzt!= null ">
			and decode(sbthcd,#{sbthcd},'未上报',sbzt) like '%'||(#{sbzt})||'%'
		</if>
		<if test="lxjsdj!='' and lxjsdj!= null ">
			and lxjsdj like '%'||(#{lxjsdj})||'%'
		</if>
		<if test="lxbm!='' and lxbm!= null ">
			and lxbm like #{lxbm}||'%'
		</if>
		<if test="bz!='' and bz!= null ">
 			and lxbm like #{bz}||'%'
 		</if>
 		<if test="tsdq!='' and tsdq!= null ">
 			and tsdq like '%'||#{tsdq}||'%'
 		</if>
	</sql>
	<select id="exportExcel_abgc" parameterType="jckabgc"
		resultType="sjbb">
		select
		sbzt v_0,gydw v_1,xzqhmc v_2,lxbm v_3,lxmc v_4,qdzh v_5,zdzh v_6,qzlc
		v_7,qzlc v_8,yhlc v_9,gjxjnd v_10,xmnf v_11
		from xmk_abgc where 1=1
		<include refid="abgc_commonsql" />
	</select>
	<insert id="importAbgc" parameterType="hashMap">
		insert into
		xmk_abgc(id,gydwbm,gydw,xzqhdm,xzqhmc,lxbm,lxmc,qdzh,zdzh,qzlc,yhlc,gjxjnd,lxjsdj,yhnr,xmnf,bz,xmtype,tbsj,tbbmbm,sbthcd,shzt,sbzt)
		values(sys_guid(),(select id from xtgl_department where name=#{0}),#{0},#{1},#{2},#{3},#{4},#{5},#{6},to_number(#{6})-to_number(#{5}),#{8},#{9},#{10},#{11},#{12},#{13},'待上报',sysdate,#{tbbmbm},#{sbthcd},'未审核','未上报')
	</insert>
	<select id="exportExcel_abgc_sh" parameterType="jckabgc" resultType="sjbb">
		select
		shzt v_0,gydw v_1,xzqhmc v_2,lxbm v_3,lxmc v_4,qdzh v_5,zdzh v_6,qzlc
		v_7,qzlc v_8,yhlc v_9,gjxjnd v_10,xmnf v_11
		from xmk_abgc where sbthcd=7
			and sbthcd>=#{sbthcd}
		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
		<if test="lxmc!='' and lxmc!= null ">
			and lxmc like '%'||(#{lxmc})||'%'
		</if>
		<if test="xmnf!='' and xmnf!= null ">
			and xmnf in (${xmnf})
		</if>
		<if test="xmtype!='' and xmtype!= null ">
			and xmtype like '%'||(#{xmtype})||'%'
		</if>
		<if test="shzt!='' and shzt!= null ">
			and shzt like '%'||(#{shzt})||'%'
		</if>
		<if test="jsdj!='' and jsdj!= null ">
			${jsdj}
		</if>
		<if test="gldj!='' and gldj!= null ">
			${gldj}
		</if>
		<if test="lxbm!='' and lxbm!= null ">
			and lxbm like #{lxbm}||'%'
		</if>
		<if test="bz!='' and bz!= null ">
 			and lxbm like #{bz}||'%'
 		</if>
 		<if test="tsdq!='' and tsdq!= null ">
 			${tsdq}
 		</if>
 		order by v_2
	</select>
	<select id="onceAbgc" parameterType="jckabgc" resultType="int">
		select count(*) from xmk_abgc where 1=1
		<if test="lxbm!='' and lxbm!= null ">
			and lxbm=#{lxbm}
		</if>
		<if test="qdzh!='' and qdzh!= null ">
			and to_number(zdzh)>to_number(#{qdzh})
		</if>
		<if test="zdzh!='' and zdzh!= null ">
			and to_number(qdzh) &lt;to_number(#{zdzh})
		</if>
	</select>
	
		<select id="daoRuabgc" parameterType="jckabgc" resultType="jckabgc">
		select roadcode lxbm,roadname lxmc,min(roadstart) qdzh,max(roadends)
		zdzh,(max(roadends)-min(roadstart)) qzlc,
		substr(roadcode,length(roadcode)-5,6) xzqhdm, 
		(select name from xtgl_xzqh where id=substr(roadcode,length(roadcode)-5,6))
		xzqhmc,F044 gydwbm,F045 gydw,
		decode(max(substr(F026, 0, 4)), null, max(substr(F025,0,4)), max(substr(F026, 0, 4)))
		gjxjnd,F114 lxjsdj from GPSROAD
		where substr(roadcode,1,1) in('G','S','X') and F048='1' 
		<if test="gydwbm!='' and gydwbm!= null ">
			and F044 in(select id from xtgl_department where id like '%'||substr(#{gydwbm},0,4)||'_'||substr(#{gydwbm},6)||'%' or parent like '%'||substr(#{gydwbm},0,4)||'_'||substr(#{gydwbm},6)||'%') 
		</if>
		group by roadname,roadcode,F114,F044, F045 having 
		<if test="lxbm!='' and lxbm!= null ">
			roadcode=#{lxbm}
		</if>
		<if test="qdzh!='' and qdzh!= null ">
			and min(roadstart) &lt;=to_number(#{qdzh})
		</if>
		<if test="zdzh!='' and zdzh!= null ">
			and max(roadends) >=to_number(#{zdzh})
		</if>
	</select>
	<select id="selAbgcCount" parameterType="jckabgc" resultType="jckabgc">
		select count(*) sbthcd,sum(qzlc) qzlc ,sum(yhlc) yhlc from xmk_abgc where 1=1
			and  sbthcd &lt;=#{sbthcd}
		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
		<if test="lxmc!='' and lxmc!= null ">
			and lxmc like '%'||(#{lxmc})||'%'
		</if>
		<if test="xmnf!='' and xmnf!= null ">
			and xmnf in (${xmnf})
		</if>
		<if test="xmtype!='' and xmtype!= null ">
			and xmtype like '%'||(#{xmtype})||'%'
		</if>
		<if test="sbzt!='' and sbzt!= null ">
			and decode(sbthcd,#{sbthcd},'未上报',sbzt) like '%'||(#{sbzt})||'%'
		</if>
		<if test="jsdj!='' and jsdj!= null ">
			${jsdj}
		</if>
		<if test="lxbm!='' and lxbm!= null ">
			and lxbm like #{lxbm}||'%'
		</if>
		<if test="gldj !='' and gldj != null ">
 			${gldj}
 		</if>
 		<if test="tsdq!='' and tsdq!= null ">
 			${tsdq}
 		</if>
	</select>
	
	<select id="selAbgcShCount" parameterType="jckabgc" resultType="jckabgc">
		select count(*) sbthcd,sum(qzlc) qzlc ,sum(yhlc) yhlc from xmk_abgc where sbthcd=7
			and sbthcd>=#{sbthcd}
		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
		<if test="lxmc!='' and lxmc!= null ">
			and lxmc like '%'||(#{lxmc})||'%'
		</if>
		<if test="xmnf!='' and xmnf!= null ">
			and xmnf in (${xmnf})
		</if>
		<if test="xmtype!='' and xmtype!= null ">
			and xmtype like '%'||(#{xmtype})||'%'
		</if>
		<if test="shzt!='' and shzt!= null ">
			and shzt like '%'||(#{shzt})||'%'
		</if>
		<if test="jsdj!='' and jsdj!= null ">
			${jsdj}
		</if>
		<if test="gldj!='' and gldj!= null ">
			${gldj}
		</if>
		<if test="lxbm!='' and lxbm!= null ">
			and lxbm like #{lxbm}||'%'
		</if>
		<if test="bz!='' and bz!= null ">
 			and lxbm like #{bz}||'%'
 		</if>
 		<if test="tsdq!='' and tsdq!= null ">
 			${tsdq}
 		</if>
	</select>
	<select id="selTsdq" resultType="jckabgc">
		select id,name xzqhmc from xtgl_tsdq order by name 
	</select>
</mapper>
