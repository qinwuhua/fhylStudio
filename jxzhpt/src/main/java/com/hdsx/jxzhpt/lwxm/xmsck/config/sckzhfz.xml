<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.sckzhfz">
<insert id="insertSckzhfz"  parameterType="sckzhfz">
	insert into sck_zhfz(sckid,xmkid,scqdzh,sczdzh,sczlc,scyhlc,tzgs,spwh,fapgdw,fascdw,faspsj,jsxz,jsnr,scbz,scbmbm,
		sck_sbzt,sck_shzt,sck_lxbm,sck_lxmc,sck_sbthcd,lrjh,bzls,scxmnf)
		values(sys_guid(),#{xmkid},#{scqdzh},#{sczdzh},#{sczlc},#{scyhlc},#{tzgs},#{spwh},#{fapgdw},#{fascdw},#{faspsj},#{jsxz},#{jsnr},#{scbz},
		#{scbmbm},'未上报','未审核',#{lxbm},#{lxmc},#{sck_sbthcd},'未列入',#{bzls},#{scxmnf})
</insert>
<insert id="lrjhSckzhfz"  parameterType="java.util.List">
		insert into plan_zhfz(id,sckid,xdzt,sbnf,jh_sbthcd) values(sys_guid(),#{sckid},'未下达',#{sbnf},#{jh_sbthcd})
</insert>
 <insert id="xglrjhSckzhfz"  parameterType="java.util.List">
		update sck_zhfz set lrjh='已列入'  where sckid=#{String}
</insert>
 
 <select id="selectSckzhfz" parameterType="sckzhfz" resultType="sckzhfz">
 	select * from (
 		select rownum num ,t.*,decode(sck_sbthcd,#{sck_sbthcd},'未上报',sck_sbzt) sck_sbzt2 from 
 			(select * from sck_zhfz t join xmk_zhfz on xmkid=xmk_zhfz.id
 			where 1=1
 				<if test="tsdq!='' and tsdq!= null ">
 				${tsdq}
 				</if><if test="xmklx !='' and xmklx != null ">
 			and xmklx like '%'||(#{xmklx})||'%'
 		</if>
 			) t where
 			sck_sbthcd &lt;=#{sck_sbthcd}
  		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and sck_lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and scxmnf in (${xmnf})
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="sbzt!='' and sbzt!= null ">
 			and decode(sck_sbthcd,#{sck_sbthcd},'未上报',sck_sbzt) like '%'||(#{sbzt})||'%'
 		</if>
 		<if test="jsdj!='' and jsdj!= null ">
 			${jsdj}
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and sck_lxbm like #{lxbm}||'%'
 		</if>
 		<if test="bzls!='' and bzls!= null ">
 			and bzls like #{bzls}||'%'
 		</if>
 		<if test="gldj!='' and gldj!= null ">
 			${gldj}
 		</if>
 			) t1 where t1.num &lt;=(#{page} * #{rows}) and t1.num>(#{page}-1)*#{rows} 
 			order by decode(sck_sbthcd,#{sck_sbthcd},'未上报',sck_sbzt),sck_shzt desc
 </select>
  <select id="selectSckZhfzCount" parameterType="sckzhfz" resultType="int">
 		select count(*) from (select * from sck_zhfz t join xmk_zhfz on xmkid=xmk_zhfz.id where 1=1
 				<if test="tsdq!='' and tsdq!= null ">
 				${tsdq}
 				</if><if test="xmklx !='' and xmklx != null ">
 			and xmklx like '%'||(#{xmklx})||'%'
 		</if>
 			) t where
 			sck_sbthcd &lt;=#{sck_sbthcd}
  		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and sck_lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and scxmnf in (${xmnf})
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="sbzt!='' and sbzt!= null ">
 			and decode(sck_sbthcd,#{sck_sbthcd},'未上报',sck_sbzt) like '%'||(#{sbzt})||'%'
 		</if>
 		<if test="jsdj!='' and jsdj!= null ">
 			${jsdj}
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and sck_lxbm like #{lxbm}||'%'
 		</if>
 		<if test="bzls!='' and bzls!= null ">
 			and bzls like #{bzls}||'%'
 		</if>
 		<if test="gldj!='' and gldj!= null ">
 			${gldj}
 		</if>
 </select>
 <select id="selectSckzhfzById" parameterType="sckzhfz" resultType="sckzhfz">
 	select * from sck_zhfz t join xmk_zhfz on xmkid=xmk_zhfz.id where sckid=#{sckid}
 </select>
 <update id="updateSckzhfz" parameterType="sckzhfz" >
 	update sck_zhfz set scqdzh=#{scqdzh},sczdzh=#{sczdzh},sczlc=#{sczlc},scyhlc=#{scyhlc},tzgs=#{tzgs},spwh=#{spwh},
 	fapgdw=#{fapgdw},fascdw=#{fascdw},faspsj=#{faspsj},jsxz=#{jsxz},jsnr=#{jsnr},scbz=#{scbz},scxmnf=#{scxmnf}
 	where sckid=#{sckid}
 </update>
 
 <delete id="deleteSckZhfz" parameterType="java.util.List" >
 	delete from sck_zhfz where sckid =#{String}
 </delete>
 
 <update id="xgSckZhfzSbzt" parameterType="hashmap" >
 	update sck_zhfz set sck_sbzt='已上报', sck_sbsj=sysdate,sck_sbbm=#{sck_sbbm},
 		sck_sbthcd=#{sck_sbthcd} where sckid =#{sckid}
 </update>
 
  <update id="xgSckZhfzShzt" parameterType="hashmap" >
 	update sck_zhfz set sck_shzt='已审核',lrjh='已列入',sck_shsj=sysdate,sck_shbm=#{sck_shbm} where sckid=#{sckid}
 </update>

 <update id="xgSckZhfzTH" parameterType="java.util.List">
	update sck_zhfz set sck_sbthcd=(sck_sbthcd+2) where sckid =#{String}
</update>
 
  <select id="selectSckShzhfz" parameterType="sckzhfz" resultType="sckzhfz">
 	select * from (
 		select rownum num ,t.* from (select * from sck_zhfz t join xmk_zhfz on xmkid=xmk_zhfz.id where 1=1
 				<if test="tsdq!='' and tsdq!= null ">
 				${tsdq}
 				</if><if test="xmklx !='' and xmklx != null ">
 			and xmklx like '%'||(#{xmklx})||'%'
 		</if>) t 
 		where sck_sbthcd=7
			and sck_sbthcd>=#{sck_sbthcd}
  		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and sck_lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and scxmnf in (${xmnf})
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="shzt!='' and shzt!= null ">
 			and sck_shzt like '%'||(#{shzt})||'%'
 		</if>
 		<if test="jsdj!='' and jsdj!= null ">
 			${jsdj}
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and sck_lxbm like #{lxbm}||'%'
 		</if>
 		<if test="bzls!='' and bzls!= null ">
 			and bzls like #{bzls}||'%'
 		</if>
 		<if test="gldj!='' and gldj!= null ">
 			${gldj}
 		</if>
 			) t1 where t1.num &lt;=(#{page} * #{rows}) and t1.num>(#{page}-1)*#{rows} 
 			order by sck_shzt desc,lrjh desc
 </select>
  <select id="selectSckZhfzShCount" parameterType="sckzhfz" resultType="int">
 		select count(*) from (select * from sck_zhfz t join xmk_zhfz on xmkid=xmk_zhfz.id where 1=1
 				<if test="tsdq!='' and tsdq!= null ">
 				${tsdq}
 				</if><if test="xmklx !='' and xmklx != null ">
 			and xmklx like '%'||(#{xmklx})||'%'
 		</if>) t 
 		where sck_sbthcd=7
			and sck_sbthcd>=#{sck_sbthcd}
  		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and sck_lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and scxmnf in (${xmnf})
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="shzt!='' and shzt!= null ">
 			and sck_shzt like '%'||(#{shzt})||'%'
 		</if>
 		<if test="jsdj!='' and jsdj!= null ">
 			${jsdj}
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and sck_lxbm like #{lxbm}||'%'
 		</if>
 		<if test="bzls!='' and bzls!= null ">
 			and bzls like #{bzls}||'%'
 		</if>
 		<if test="gldj!='' and gldj!= null ">
 			${gldj}
 		</if>
 </select>
  <select id="onceSckZhfz" parameterType="sckzhfz" resultType="int">
		select count(*) from sck_zhfz where lrjh='未列入'
		<if test="lxbm!='' and lxbm!= null ">
			and sck_lxbm=#{lxbm}
		</if>
		<if test="qdzh!='' and qdzh!= null ">
			and to_number(sczdzh)>to_number(#{qdzh})
		</if>
		<if test="zdzh!='' and zdzh!= null ">
			and to_number(scqdzh) &lt;to_number(#{zdzh})
		</if>
		<if test="scxmnf!='' and scxmnf!=  null "  >
 			and scxmnf=#{scxmnf}
 		</if>
	</select>
 <select id="bzZhfz" parameterType="sckzhfz" resultType="int">
		SELECT C1.CON1+C2.CON2 FROM
(select count(*) CON1 from sck_zhfz where lrjh='已列入' 
and sck_lxbm=#{lxbm}
and to_number(sczdzh)>=to_number(#{qdzh})
and to_number(scqdzh) &lt;=to_number(#{zdzh})
)C1,
(select count(*) CON2 from sck_zhfz SC,
(select YLXBM,YQDZH,YZDZH from XTGL_LXSJ where XLXBM =#{lxbm} and XQDZH &lt;=to_number(#{zdzh}) and XZDZH>=to_number(#{qdzh})) k
where SC.lrjh='已列入' AND  SC.sck_lxbm=k.YLXBM and SC.scqdzh &lt;k.YZDZH and SC.sczdzh>k.YQDZH
)C2
	</select>
	<select id="daoRuzhfzsh" parameterType="sckzhfz" resultType="sckzhfz">
 		select * from xmk_zhfz where shzt='已审核'
 		<if test="gydwbm!='' and gydwbm!= null ">
			and tbbmbm in(select id from xtgl_department where id like #{gydwbm}||'%' or parent like #{gydwbm}||'%') 
		</if>
 		<if test="lxbm!='' and lxbm!= null ">
			and lxbm=#{lxbm}
		</if>
		<if test="qdzh!='' and qdzh!= null ">
			and to_number(qdzh) &lt;=#{qdzh}
		</if>
		<if test="zdzh!='' and zdzh!= null ">
			and to_number(zdzh) >=#{zdzh}
		</if>
 </select>	
	
  <select id="exportExcel_zhfz_scgl" parameterType="sckzhfz" resultType="elist">
 	select rownum v_0,x.xzqhdm v_1,x.xzqhmc v_2,x.lxbm v_3,x.lxmc v_4,t.scqdzh v_5,t.sczdzh v_6,t.sczlc v_7,t.scyhlc v_8,
       x.gjxjnd v_9,t.fapgdw v_10,t.fascdw v_11,t.faspsj v_12,t.spwh v_13,t.tzgs v_14,
       t.jsxz v_15,t.jsnr v_16,t.scxmnf v_17,t.scbz v_18
   from sck_zhfz t join xmk_zhfz x on xmkid=x.id 
   where 1=1
 	and sck_sbthcd &lt;=#{sck_sbthcd}
 	<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
	    <if test="lxmc!='' and lxmc!= null ">
 			and sck_lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and scxmnf in (${xmnf})
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="sbzt!='' and sbzt!= null ">
 			and decode(sck_sbthcd,#{sck_sbthcd},'未上报',sck_sbzt) like '%'||(#{sbzt})||'%'
 		</if>
 		<if test="jsdj!='' and jsdj!= null ">
 			${jsdj}
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and sck_lxbm like #{lxbm}||'%'
 		</if>
 		<if test="bzls!='' and bzls!= null ">
 			and bzls like #{bzls}||'%'
 		</if>
 		<if test="bz!='' and bz!= null ">
 			and sck_lxbm like #{bz}||'%'
 		</if>
 		<if test="tsdq!='' and tsdq!= null ">
 				${tsdq}
 	    </if>
 	    <if test="xmklx !='' and xmklx != null ">
 			and xmklx like '%'||(#{xmklx})||'%'
 		</if>
 		<if test="gldj!='' and gldj!= null ">
 			${gldj}
 		</if>
 </select>
  <select id="exportExcel_zhfz_scsh" parameterType="sckzhfz" resultType="elist">
 	select rownum v_0,x.xzqhdm v_1,x.xzqhmc v_2,x.lxbm v_3,x.lxmc v_4,t.scqdzh v_5,t.sczdzh v_6,t.sczlc v_7,t.scyhlc v_8,
       x.gjxjnd v_9,t.fapgdw v_10,t.fascdw v_11,t.faspsj v_12,t.spwh v_13,t.tzgs v_14,
       t.jsxz v_15,t.jsnr v_16,t.scxmnf v_17,t.scbz v_18
   from sck_zhfz t join xmk_zhfz x on xmkid=x.id 
   where 1=1 and sck_sbthcd=7
 	and sck_sbthcd >=#{sck_sbthcd}
 	<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
	<if test="lxmc!='' and lxmc!= null ">
 			and sck_lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and scxmnf in (${xmnf})
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="shzt!='' and shzt!= null ">
 			and shzt like '%'||(#{shzt})||'%'
 		</if>
 		<if test="jsdj!='' and jsdj!= null ">
 			${jsdj}
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and sck_lxbm like #{lxbm}||'%'
 		</if>
 		<if test="bzls!='' and bzls!= null ">
 			and bzls like #{bzls}||'%'
 		</if>
 		<if test="bz!='' and bz!= null ">
 			and sck_lxbm like #{bz}||'%'
 		</if>
 		<if test="tsdq!='' and tsdq!= null ">
 				${tsdq}
 	    </if>
 	    <if test="xmklx !='' and xmklx != null ">
 			and xmklx like '%'||(#{xmklx})||'%'
 		</if>
 		<if test="gldj!='' and gldj!= null ">
 			${gldj}
 		</if>
 </select>
 <select id="insertToSheet" resultType="sjbb" parameterType="hashMap">
 	select 
 	gydw v_0,xzqhdm v_0,xzqhmc v_1,lxbm v_2,lxmc v_3,qdzh v_4,zdzh v_5,qzlc v_6,yhlc v_7,gjxjnd v_8
 	from xmk_zhfz where shzt='已审核'
 	and id not in (select xmkid from sck_zhfz)
	<if test="tbdw!=null and tbdw!=''">
		and tbbmbm like #{tbdw}||'%'
	</if>
 </select>
  <insert id="importZhfz_sc" parameterType="hashMap">
	insert into sck_zhfz(sckid,xmkid,
	sck_lxbm,sck_lxmc,scqdzh,sczdzh,sczlc,scyhlc,fapgdw,fascdw,faspsj,spwh,tzgs,jsxz,jsnr,scbz,sck_sbzt,sck_shzt,scbmbm,sck_sbthcd,lrjh,bzls)
	values(sys_guid(),(select ID from XMK_Zhfz where lxbm=trim(#{2}) and lxmc=trim(#{3})),
	#{2},#{3},#{9},#{10},to_number(#{10})-to_number(#{9}),#{11},#{12},#{13},#{14},#{15},#{16},#{17},#{18},#{19},'未上报','未审核',#{scbmbm},#{sck_sbthcd},'未列入','无')
 </insert>
 <select id="selSckZhfzCount" parameterType="sckzhfz" resultType="sckzhfz">
 		select count(*) sck_sbthcd,sum(sczlc) sczlc,sum(scyhlc) scyhlc from (select * from sck_zhfz t join xmk_zhfz on xmkid=xmk_zhfz.id where 1=1
 				<if test="tsdq!='' and tsdq!= null ">
 				${tsdq}
 				</if>
 			) t where
 			sck_sbthcd &lt;=#{sck_sbthcd}
  		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and sck_lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and scxmnf in (${xmnf})
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="sbzt!='' and sbzt!= null ">
 			and decode(sck_sbthcd,#{sck_sbthcd},'未上报',sck_sbzt) like '%'||(#{sbzt})||'%'
 		</if>
 		<if test="jsdj!='' and jsdj!= null ">
 			${jsdj}
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and sck_lxbm like #{lxbm}||'%'
 		</if>
 		<if test="bzls!='' and bzls!= null ">
 			and bzls like #{bzls}||'%'
 		</if>
 		<if test="gldj!='' and gldj!= null ">
 			${gldj}
 		</if>
 </select>
   <select id="selSckZhfzShCount" parameterType="sckzhfz" resultType="sckzhfz">
 	select count(*) sck_sbthcd,sum(sczlc) sczlc,sum(scyhlc) scyhlc from (select * from sck_zhfz t join xmk_zhfz on xmkid=xmk_zhfz.id where 1=1
 				<if test="tsdq!='' and tsdq!= null ">
 				${tsdq}
 				</if><if test="xmklx !='' and xmklx != null ">
 			and xmklx like '%'||(#{xmklx})||'%'
 		</if>) t 
 		where sck_sbthcd=7
			and sck_sbthcd>=#{sck_sbthcd}
  		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and sck_lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and scxmnf in (${xmnf})
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="shzt!='' and shzt!= null ">
 			and sck_shzt like '%'||(#{shzt})||'%'
 		</if>
 		<if test="jsdj!='' and jsdj!= null ">
 			${jsdj}
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and sck_lxbm like #{lxbm}||'%'
 		</if>
 		<if test="bzls!='' and bzls!= null ">
 			and bzls like #{bzls}||'%'
 		</if>
 		<if test="gldj!='' and gldj!= null ">
 			${gldj}
 		</if>
 </select>
 
 	<!--  列入计划-->
 
 <select id="lrjhZhfz" parameterType="sckzhfz" resultType="sckzhfz">
 	select * from (
 		select rownum num ,t.* from (select * from sck_zhfz t join xmk_zhfz on xmkid=xmk_zhfz.id where 1=1
 				<if test="tsdq!='' and tsdq!= null ">
 				and xmk_zhfz.tsdq like '%'||#{tsdq}||'%'
 				</if>) t 
 		where sck_shzt='已审核' and lrjh='未列入'
			and sck_sbthcd>=#{sck_sbthcd}
  			<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
			<if test="lxmc!='' and lxmc!= null ">
 			and sck_lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and scxmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="lxjsdj!='' and lxjsdj!= null ">
 			and lxjsdj like '%'||(#{lxjsdj})||'%'
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and sck_lxbm like #{lxbm}||'%'
 		</if>
 		<if test="bzls!='' and bzls!= null ">
 			and bzls like #{bzls}||'%'
 		</if>
 		<if test="bz!='' and bz!= null ">
 			and sck_lxbm like #{bz}||'%'
 		</if>
 			) t1 where t1.num &lt;=(#{page} * #{rows}) and t1.num>(#{page}-1)*#{rows} 
 			order by sck_shzt desc,lrjh desc
 </select>
  <select id="lrjhZhfzCount" parameterType="sckzhfz" resultType="int">
 		select count(*) from (select * from sck_zhfz t join xmk_zhfz on xmkid=xmk_zhfz.id where 1=1
 				<if test="tsdq!='' and tsdq!= null ">
 				and xmk_zhfz.tsdq like '%'||#{tsdq}||'%'
 				</if>)
 		 where sck_shzt='已审核' and lrjh='未列入'
			and sck_sbthcd>=#{sck_sbthcd}
 			<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
			<if test="lxmc!='' and lxmc!= null ">
 			and sck_lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and scxmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="lxjsdj!='' and lxjsdj!= null ">
 			and lxjsdj like '%'||(#{lxjsdj})||'%'
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and sck_lxbm like #{lxbm}||'%'
 		</if>
 		<if test="bzls!='' and bzls!= null ">
 			and bzls like #{bzls}||'%'
 		</if>
 		<if test="bz!='' and bz!= null ">
 			and sck_lxbm like #{bz}||'%'
 		</if>
 </select>
 <update id="xgZhfzXmnf" parameterType="sckzhfz" >
 		update xmk_zhfz set xmnf=#{xmnf} where id=#{xmkid}
 </update>
 <select id="queryMqidj" parameterType="sckzhfz" resultType="String">
	   select WMSYS.WM_CONCAT(t.mqidj) mqiStr from(
           select fn_ReturnFllx(lmd.mqi)  mqidj
                  from lkpd_mxb_data_2014 lmd
                   where lmd.lxbh in (#{lxbm})
                   left join lkpd_mxb2014 m on lmd.mxb_id=m.id   
                   and to_number(lmd.qdzh) &gt;= to_number(#{scqdzh})
                   and to_number(lmd.zdzh) &lt;= to_number(#{sczdzh})
                   and m.tbnf in ('2016') and lmd.jsdj !='高速'   
                   group by fn_ReturnFllx(lmd.mqi)
                   order by DECODE(fn_ReturnFllx(lmd.mqi),'优','1','良','2','中','3','次','4','差','5'))t
</select>
</mapper>
