<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.tjfx">
	<select id="queryLmgzNfByXzqhdm" resultType="java.util.Map" parameterType="java.util.Map">
		select #{xzqhdm} xzqhdm,NVL(sum(j.pfztz),0) lmgjztz,NVL(sum(j.bbzzj),0) lmgjcgs,NVL(sum(j.sbzzj),0) lmgjstz,count(j.xmbm) lmgjsl from jhsh_lmgz j left join lxsh_lmgz l on j.xmbm=l.xmbm 
		where j.xmbm like #{nf}||'%' and l.xzqhdm like '%'||<if test="xzqhdm!='360000'">substr(#{xzqhdm},0,4)</if><if test="xzqhdm=='360000'">rtrim(#{xzqhdm},'0')</if>||'%' 
		group by #{xzqhdm}
	</select>
	<select id="queryLmsjNfByXzqhdm" resultType="java.util.Map" parameterType="java.util.Map">
		select #{xzqhdm} xzqhdm,NVL(sum(j.pfztz),0) lmsjztz,NVL(sum(j.bbzzj),0) lmsjcgs,NVL(sum(j.sbzzj),0) lmsjstz,count(j.xmbm) lmsjsl from jhsh_sjgz j left join lxsh_sjgz l on j.xmbm=l.xmbm 
		where j.xmbm like #{nf}||'%' and l.xzqhdm like '%'||<if test="xzqhdm!='360000'">substr(#{xzqhdm},0,4)</if><if test="xzqhdm=='360000'">rtrim(#{xzqhdm},'0')</if>||'%' 
    	group by #{xzqhdm}
	</select>
	<select id="queryXjNfByXzqhdm" resultType="java.util.Map" parameterType="java.util.Map">
		select #{xzqhdm} xzqhdm,NVL(sum(j.pfztz),0) xjztz,NVL(sum(j.bbzzj),0) xjcgs,NVL(sum(j.sbzzj),0) xjstz,count(j.xmbm) xjsl from jhsh_xj j left join lxsh_xj l on j.xmbm=l.xmbm 
		where j.xmbm like #{nf}||'%' and l.xzqhdm like <if test="xzqhdm!='360000'">substr(#{xzqhdm},0,4)</if><if test="xzqhdm=='360000'">rtrim(#{xzqhdm},'0')</if>||'%' 
		group by #{xzqhdm}
	</select>
	<select id="queryYhNfByXzqhdm" resultType="java.util.Map" parameterType="java.util.Map">
		select #{xzqhdm} xzqhdm,NVL(sum(j.ztz),0) yhdzxztz,NVL(sum(j.yqdbcgs),0) yhdzxcgs,NVL(sum(to_number(j.sysbbzj)-to_number(j.yqdbcgs)),0) yhdzxstz,count(j.xmbm) yhdzxsl from jhsh_yhdzx j left join xmsq_yhdzx l on j.xmbm = l.xmbm
		where j.xmbm like #{nf}||'%' and l.xzqhdm like <if test="xzqhdm!='360000'">substr(#{xzqhdm},0,4)</if><if test="xzqhdm=='360000'">rtrim(#{xzqhdm},'0')</if>||'%' 
		group by #{xzqhdm}
	</select>
	<select id="queryShNfByXzqhdm" resultType="java.util.Map" parameterType="java.util.Map">
		select #{xzqhdm} xzqhdm,NVL(sum(j.pfztz),0) shztz,NVL(sum(j.bbzzj),0) shcgs,NVL(sum(j.sbzzj),0) shstz,count(j.xmbm) shsl from jhsh_sh j left join xmsq_sh l on j.xmbm = l.xmbm
		where j.xmbm like #{nf}||'%' and l.xzqhdm like <if test="xzqhdm!='360000'">substr(#{xzqhdm},0,4)</if><if test="xzqhdm=='360000'">rtrim(#{xzqhdm},'0')</if>||'%' 
		group by #{xzqhdm}
	</select>
	<select id="queryAbgcNfByXzqhdm" resultType="java.util.Map" parameterType="java.util.Map">
		select #{xzqhdm} xzqhdm,NVL(sum(j.pfztz),0) abgcztz,NVL(sum(j.jhsybbzje),0) abgccgs,NVL(sum(j.jhsydfzczj),0) abgcstz,count(j.id) abgcsl
		from plan_abgc j left join sck_abgc absc on (j.sckid=absc.sckid) left join xmk_abgc l on (absc.xmkid=l.id)
		where j.jhnf=#{nf} and l.xzqhdm like '%'||<if test="xzqhdm!='360000'">substr(#{xzqhdm},0,4)</if><if test="xzqhdm=='360000'">rtrim(#{xzqhdm},'0')</if>||'%' 
		group by #{xzqhdm}
	</select>
	<select id="queryZhfzNfByXzqhdm" resultType="java.util.Map" parameterType="java.util.Map">
		select #{xzqhdm} xzqhdm,NVL(sum(j.pfztz),0) zhfzztz,NVL(sum(j.jhsybzje),0) zhfzcgs,NVL(sum(j.jhsydfzcje),0) zhfzstz,count(j.id) zhfzsl
		from plan_zhfz j left join sck_zhfz zhsc on (j.sckid=zhsc.sckid) left join xmk_zhfz l on (zhsc.xmkid=l.id)
		where j.sbnf = #{nf} and l.xzqhdm like '%'||<if test="xzqhdm!='360000'">substr(#{xzqhdm},0,4)</if><if test="xzqhdm=='360000'">rtrim(#{xzqhdm},'0')</if>||'%' 
		group by #{xzqhdm}
	</select>
	<select id="queryWqgzNfByXzqhdm" resultType="java.util.Map" parameterType="java.util.Map">
		select #{xzqhdm} xzqhdm,NVL(sum(j.pfztz),0) wqgzztz,NVL(sum(j.jhsybzje),0) wqgzcgs,NVL(sum(j.jhsydfzcje),0) wqgzstz,count(j.id) wqgzsl
		from plan_wqgz j left join sck_wqgz jsc on (j.sckid=jsc.sckid) left join xmk_wqgz l on (jsc.xmkid=l.id)
		where l.xzqhdm like '%'||<if test="xzqhdm!='360000'">substr(#{xzqhdm},0,4)</if><if test="xzqhdm=='360000'">rtrim(#{xzqhdm},'0')</if>||'%' and j.sbnf=#{nf} 
		group by #{xzqhdm}
	</select>
	<select id="queryXzqhQsfx" resultType="java.util.Map" parameterType="java.util.Map">
		<![CDATA[select nf,nvl(sum(ztz),0) ztz,nvl(sum(stz),0) stz,nvl(sum(btz),0) btz,nvl(sum(zj),0) zj from (
		select substr(j.xmbm,0,4) nf,sum(j.pfztz) ztz,sum(j.sbzzj) stz,sum(j.bbzzj) btz,count(j.xmbm) zj
		from jhsh_lmgz j left join lxsh_lmgz l on j.xmbm=l.xmbm 
		where l.xzqhdm like #{xzqhdm}||'%' and substr(j.xmbm,0,4)>=${start} and substr(j.xmbm,0,4)<=${end} group by substr(j.xmbm,0,4)
		union all
		select substr(j.xmbm,0,4) nf,sum(j.pfztz) ztz,sum(j.sbzzj) stz,sum(j.bbzzj) btz,count(j.xmbm) zj
		from jhsh_sjgz j left join lxsh_sjgz l on j.xmbm=l.xmbm 
		where l.xzqhdm like #{xzqhdm}||'%' and substr(j.xmbm,0,4)>=${start} and substr(j.xmbm,0,4)<=${end} group by substr(j.xmbm,0,4)
		union all
		select substr(j.xmbm,0,4) nf,sum(j.pfztz) ztz,sum(j.sbzzj) stz,sum(j.bbzzj) btz,count(j.xmbm) zj
		from jhsh_xj j left join lxsh_xj l on j.xmbm=l.xmbm 
		where l.xzqhdm like #{xzqhdm}||'%' and substr(j.xmbm,0,4)>=${start} and substr(j.xmbm,0,4)<=${end} group by substr(j.xmbm,0,4)
		union all
		select substr(j.xmbm,0,4) nf,sum(j.ztz) ztz,sum(j.sysbbzj-j.yqdbcgs) stz,sum(j.yqdbcgs) btz,count(j.xmbm) zj
		from jhsh_yhdzx j left join xmsq_yhdzx l on j.xmbm=l.xmbm 
		where l.xzqhdm like #{xzqhdm}||'%' and substr(j.xmbm,0,4)>=${start} and substr(j.xmbm,0,4)<=${end} group by substr(j.xmbm,0,4)
		union all
		select substr(j.xmbm,0,4) nf,sum(j.pfztz) ztz,sum(j.sbzzj) stz,sum(j.bbzzj) btz,count(j.xmbm) zj
		from jhsh_sh j left join xmsq_sh l on j.xmbm=l.xmbm 
		where l.xzqhdm like #{xzqhdm}||'%' and substr(j.xmbm,0,4)>=${start} and substr(j.xmbm,0,4)<=${end} group by substr(j.xmbm,0,4)
		union all
		select wq.sbnf,sum(wq.pfztz),sum(wq.jhsybzje),sum(wq.jhsydfzcje),count(wq.id)
		from plan_wqgz wq left join sck_wqgz wqsc on (wq.sckid=wqsc.sckid) left join xmk_wqgz wqlx on (wqsc.xmkid=wqlx.id)
		where wqlx.xzqhdm like #{xzqhdm}||'%' and wq.sbnf>=${start} and wq.sbnf<=${end} group by wq.sbnf
		union all
		select abjh.jhnf,sum(abjh.pfztz),sum(abjh.jhsybbzje),sum(abjh.jhsydfzczj),count(abjh.id)
		from plan_abgc abjh left join sck_abgc absc on (abjh.sckid=absc.sckid) left join xmk_abgc ablx on (absc.xmkid=ablx.id)
		where ablx.xzqhdm like #{xzqhdm}||'%' and abjh.jhnf>${start} and abjh.jhnf<=${end} group by abjh.jhnf
		union all
		select zhjh.sbnf,sum(zhjh.pfztz),sum(zhjh.jhsybzje),sum(zhjh.jhsydfzcje),count(zhjh.id)
		from plan_zhfz zhjh left join sck_zhfz zhsc on (zhjh.sckid=zhsc.sckid) left join xmk_zhfz zhlx on (zhsc.xmkid=zhlx.id)
		where zhlx.xzqhdm like #{xzqhdm}||'%' and zhjh.sbnf>=${start} and zhjh.sbnf<=${end} group by zhjh.sbnf
		) group by nf order by nf]]>
	</select>
	<select id="queryXmlxQsfx" resultType="java.util.Map" parameterType="java.util.Map">
		<![CDATA[
		select nf,nvl(ztz,0) ztz,nvl(stz,0) stz,nvl(btz,0) btz,nvl(zj,0) zj,xmlx from (
		select abjh.jhnf nf,sum(abjh.pfztz) ztz,sum(abjh.jhsybbzje) btz,sum(abjh.jhsydfzczj) stz,count(abjh.id) zj,'安保工程' xmlx
		from plan_abgc abjh left join sck_abgc absc on (abjh.sckid=absc.sckid) left join xmk_abgc ablx on (absc.xmkid=ablx.id)
		where ablx.xzqhdm like #{xzqhdm}||'%' and abjh.jhnf>=${start} and abjh.jhnf<=${end} group by abjh.jhnf
		union all
		select wq.sbnf,sum(wq.pfztz),sum(wq.jhsybzje),sum(wq.jhsydfzcje),count(wq.id),'危桥改造' xmlx
		from plan_wqgz wq left join sck_wqgz wqsc on (wq.sckid=wqsc.sckid) left join xmk_wqgz wqlx on (wqsc.xmkid=wqlx.id)
		where wqlx.xzqhdm like #{xzqhdm}||'%' and wq.sbnf>=${start} and wq.sbnf<=${end} group by wq.sbnf
		union all
		select zhjh.sbnf,sum(zhjh.pfztz),sum(zhjh.jhsybzje),sum(zhjh.jhsydfzcje),count(zhjh.id),'灾害防治' xmlx
		from plan_zhfz zhjh left join sck_zhfz zhsc on (zhjh.sckid=zhsc.sckid) left join xmk_zhfz zhlx on (zhsc.xmkid=zhlx.id)
		where zhlx.xzqhdm like #{xzqhdm}||'%' and zhjh.sbnf>=${start} and zhjh.sbnf<=${end} group by zhjh.sbnf
		union all
		select substr(j.xmbm,0,4) nf,sum(j.pfztz) ztz,sum(j.sbzzj) stz,sum(j.bbzzj) btz,count(j.xmbm) zj,'改建工程' xmlx
		from jhsh_sjgz j left join lxsh_sjgz l on j.xmbm=l.xmbm 
		where l.xzqhdm like #{xzqhdm}||'%' and substr(j.xmbm,0,4)>=${start} and substr(j.xmbm,0,4)<=${end} group by substr(j.xmbm,0,4)
		union all
		select substr(j.xmbm,0,4) nf,sum(j.pfztz) ztz,sum(j.sbzzj) stz,sum(j.bbzzj) btz,count(j.xmbm) zj,'路面改造工程' xmlx
		from jhsh_lmgz j left join lxsh_lmgz l on j.xmbm=l.xmbm 
		where l.xzqhdm like #{xzqhdm}||'%' and substr(j.xmbm,0,4)>=${start} and substr(j.xmbm,0,4)<=${end} group by substr(j.xmbm,0,4)
		union all
		select substr(j.xmbm,0,4) nf,sum(j.pfztz) ztz,sum(j.sbzzj) stz,sum(j.bbzzj) btz,count(j.xmbm) zj,'新建工程' xmlx
		from jhsh_xj j left join lxsh_xj l on j.xmbm=l.xmbm 
		where l.xzqhdm like #{xzqhdm}||'%' and substr(j.xmbm,0,4)>=${start} and substr(j.xmbm,0,4)<=${end} group by substr(j.xmbm,0,4)
		union all
		select substr(j.xmbm,0,4) nf,sum(j.ztz) ztz,sum(j.sysbbzj-j.yqdbcgs) stz,sum(j.yqdbcgs) btz,count(j.xmbm) zj,'养护大中修工程' xmlx
		from jhsh_yhdzx j left join xmsq_yhdzx l on j.xmbm=l.xmbm 
		where l.xzqhdm like #{xzqhdm}||'%' and substr(j.xmbm,0,4)>=${start} and substr(j.xmbm,0,4)<=${end} group by substr(j.xmbm,0,4)
		union all
		select substr(j.xmbm,0,4) nf,sum(j.pfztz) ztz,sum(j.sbzzj) stz,sum(j.bbzzj) btz,count(j.xmbm) zj,'灾毁重建' xmlx
		from jhsh_sh j left join xmsq_sh l on j.xmbm=l.xmbm 
		where l.xzqhdm like #{xzqhdm}||'%' and substr(j.xmbm,0,4)>=${start} and substr(j.xmbm,0,4)<=${end} group by substr(j.xmbm,0,4))
		]]>
	</select>
	<select id="queryGckXzqhtj" resultType="java.util.Map" parameterType="java.util.Map">
		select (sum(wkgztz)+sum(zjztz)+sum(wgztz)) ztz,(sum(zjwc)+sum(wgwc)) wctz,(sum(wkgsl)+sum(zjsl)+sum(wgsl)) sl,
		sum(wkgztz) wkgztz,sum(wkgsl) wkgsl,sum(zjztz) zjztz,sum(zjwc) zjwctz,sum(zjsl) zjsl,sum(wgztz) jgztz,sum(wgwc) jgwctz,sum(wgsl) jgsl from(
		select * from 
		(select nvl(sum(z.xdzj),0) wkgztz from jhsh_lmgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='0') wkg1,
		(select count(distinct j.xmbm) wkgsl from jhsh_lmgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='0') wkg2,
		(select nvl(sum(z.xdzj),0) zjztz from jhsh_lmgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_gcgzgj g left join jhsh_lmgz j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj2,
		(select count(distinct j.xmbm) zjsl from jhsh_lmgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj3,
		(select nvl(sum(z.xdzj),0) wgztz from jhsh_lmgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wgwc from gcgl_gcgzgj g left join jhsh_lmgz j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg2,
		(select count(distinct j.xmbm) wgsl from jhsh_lmgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg3
		union all
		select * from 
		(select nvl(sum(z.xdzj),0) wkgztz from jhsh_sjgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='0') wkg1,
		(select count(distinct j.xmbm) wkgsl from jhsh_sjgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='0') wkg2,
		(select nvl(sum(z.xdzj),0) zjztz from jhsh_sjgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj1,
		(select nvl(sum(g.bywctze),0) zjwc from gcgl_gcgzsj g left join jhsh_sjgz j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj2,
		(select count(distinct j.xmbm) zjsl from jhsh_sjgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj3,
		(select nvl(sum(z.xdzj),0) wgztz from jhsh_sjgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg1,
		(select nvl(sum(g.bywctze),0) wgwc from gcgl_gcgzsj g left join jhsh_sjgz j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg2,
		(select count(distinct j.xmbm) wgsl from jhsh_sjgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg3
		union all
		select * from 
		(select nvl(sum(z.xdzj),0) wkgztz from jhsh_xj j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='0') wkg1,
		(select count(distinct j.xmbm) wkgsl from jhsh_xj j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='0') wkg2,
		(select nvl(sum(z.xdzj),0) zjztz from jhsh_xj j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_xj g left join jhsh_xj j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj2,
		(select count(distinct j.xmbm) zjsl from jhsh_xj j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj3,
		(select nvl(sum(z.xdzj),0) wgztz from jhsh_xj j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wgwc from gcgl_xj g left join jhsh_xj j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg2,
		(select count(distinct j.xmbm) wgsl from jhsh_xj j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg3
		union all
		select * from 
		(select nvl(sum(z.xdzj),0) wkgztz from jhsh_yhdzx j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='0') wkg1,
		(select count(distinct j.xmbm) wkgsl from jhsh_yhdzx j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='0') wkg2,
		(select nvl(sum(z.xdzj),0) zjztz from jhsh_yhdzx j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_yhdzx g left join jhsh_yhdzx j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj2,
		(select count(distinct j.xmbm) zjsl from jhsh_yhdzx j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj3,
		(select nvl(sum(z.xdzj),0) wgztz from jhsh_yhdzx j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wgwc from gcgl_yhdzx g left join jhsh_yhdzx j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg2,
		(select count(distinct j.xmbm) wgsl from jhsh_yhdzx j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg3
		union all
		select * from 
		(select nvl(sum(z.xdzj),0) wkgztz from jhsh_sh j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='0') wkg1,
		(select count(distinct j.xmbm) wkgsl from jhsh_sh j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='0') wkg2,
		(select nvl(sum(z.xdzj),0) zjztz from jhsh_sh j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_sh g left join jhsh_sh j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj2,
		(select count(distinct j.xmbm) zjsl from jhsh_sh j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj3,
		(select nvl(sum(z.xdzj),0) wgztz from jhsh_sh j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wgwc from gcgl_sh g left join jhsh_sh j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg2,
		(select count(distinct j.xmbm) wgsl from jhsh_sh j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg3
		union all
		select * from
		(select nvl(sum(z.xdzj),0) wkgztz from plan_zjxd z left join plan_abgc p on z.xmid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf=#{nf} and p.kgzt='0') wkg1,
		(select count(distinct p.id) wkgsl from plan_zjxd z left join plan_abgc p on z.xmid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf=#{nf} and p.kgzt='0') wkg2,
		(select nvl(sum(z.xdzj),0) zjztz from plan_zjxd z left join plan_abgc p on z.xmid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf=#{nf} and p.kgzt='1' and p.jgzt='0') zj1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_abgc g left join plan_abgc p on g.jhid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf=#{nf} and p.kgzt='1' and p.jgzt='0') zj2,
		(select count(distinct p.id) zjsl from plan_zjxd z left join plan_abgc p on z.xmid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf=#{nf} and p.kgzt='1' and p.jgzt='0') zj3,
		(select nvl(sum(z.xdzj),0) wgztz from plan_zjxd z left join plan_abgc p on z.xmid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf=#{nf} and p.kgzt='1' and p.jgzt='1') wg1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wgwc from gcgl_abgc g left join plan_abgc p on g.jhid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf=#{nf} and p.kgzt='1' and p.jgzt='1') wg2,
		(select count(distinct p.id) wgsl from plan_zjxd z left join plan_abgc p on z.xmid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf=#{nf} and p.kgzt='1' and p.jgzt='1') wg3
		union all
		select * from
		(select nvl(sum(z.xdzj),0) wkgztz from plan_zjxd z left join plan_zhfz p on z.xmid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='0') wkg1,
		(select count(distinct p.id) wkgsl from plan_zjxd z left join plan_zhfz p on z.xmid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='0') wkg2,
		(select nvl(sum(z.xdzj),0) zjztz from plan_zjxd z left join plan_zhfz p on z.xmid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='1' and p.jgzt='0') zj1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_zhfz g left join plan_zhfz p on g.jhid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='1' and p.jgzt='0') zj2,
		(select count(distinct p.id) zjsl from plan_zjxd z left join plan_zhfz p on z.xmid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='1' and p.jgzt='0') zj3,
		(select nvl(sum(z.xdzj),0) wgztz from plan_zjxd z left join plan_zhfz p on z.xmid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='1' and p.jgzt='1') wg1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wgwc from gcgl_zhfz g left join plan_zhfz p on g.jhid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='1' and p.jgzt='1') wg2,
		(select count(distinct p.id) wgsl from plan_zjxd z left join plan_zhfz p on z.xmid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='1' and p.jgzt='1') wg3
		union all
		select * from
		(select nvl(sum(z.xdzj),0) wkgztz from plan_zjxd z left join plan_wqgz p on z.xmid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='0') wkg1,
		(select count(distinct p.id) wkgsl from plan_zjxd z left join plan_wqgz p on z.xmid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='0') wkg2,
		(select nvl(sum(z.xdzj),0) zjztz from plan_zjxd z left join plan_wqgz p on z.xmid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='1' and p.jgzt='0') zj1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_wqgz g left join plan_wqgz p on g.jhid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='1' and p.jgzt='0') zj2,
		(select count(distinct p.id) zjsl from plan_zjxd z left join plan_wqgz p on z.xmid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='1' and p.jgzt='0') zj3,
		(select nvl(sum(z.xdzj),0) wgztz from plan_zjxd z left join plan_wqgz p on z.xmid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='1' and p.jgzt='1') wg1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wgwc from gcgl_wqgz g left join plan_wqgz p on g.jhid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='1' and p.jgzt='1') wg2,
		(select count(distinct p.id) wgsl from plan_zjxd z left join plan_wqgz p on z.xmid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='1' and p.jgzt='1') wg3)
	</select>
	<select id="queryGckXmlxtj" resultType="java.util.Map" parameterType="java.util.Map">
		select '安保工程' xmlx,wkg1.*,wkg2.*,zj1.*,zj2.*,zj3.*,wg1.*,wg2.*,wg3.*,
		(wkgztz+zjztz+wgztz) ztz,(zjwc+wgwc) wctz,(wkgsl+zjsl+wgsl) sl from
		(select nvl(sum(z.xdzj),0) wkgztz from plan_zjxd z left join plan_abgc p on z.xmid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf=#{nf} and p.kgzt='0') wkg1,
		(select count(distinct p.id) wkgsl from plan_zjxd z left join plan_abgc p on z.xmid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf=#{nf} and p.kgzt='0') wkg2,
		(select nvl(sum(z.xdzj),0) zjztz from plan_zjxd z left join plan_abgc p on z.xmid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf=#{nf} and p.kgzt='1' and p.jgzt='0') zj1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_abgc g left join plan_abgc p on g.jhid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf=#{nf} and p.kgzt='1' and p.jgzt='0') zj2,
		(select count(distinct p.id) zjsl from plan_zjxd z left join plan_abgc p on z.xmid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf=#{nf} and p.kgzt='1' and p.jgzt='0') zj3,
		(select nvl(sum(z.xdzj),0) wgztz from plan_zjxd z left join plan_abgc p on z.xmid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf=#{nf} and p.kgzt='1' and p.jgzt='1') wg1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wgwc from gcgl_abgc g left join plan_abgc p on g.jhid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf=#{nf} and p.kgzt='1' and p.jgzt='1') wg2,
		(select count(distinct p.id) wgsl from plan_zjxd z left join plan_abgc p on z.xmid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf=#{nf} and p.kgzt='1' and p.jgzt='1') wg3
		union all
		select '危桥改造' xmlx,wkg1.*,wkg2.*,zj1.*,zj2.*,zj3.*,wg1.*,wg2.*,wg3.*,
		(wkgztz+zjztz+wgztz) ztz,(zjwc+wgwc) wctz,(wkgsl+zjsl+wgsl) sl from
		(select nvl(sum(z.xdzj),0) wkgztz from plan_zjxd z left join plan_wqgz p on z.xmid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='0') wkg1,
		(select count(distinct p.id) wkgsl from plan_zjxd z left join plan_wqgz p on z.xmid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='0') wkg2,
		(select nvl(sum(z.xdzj),0) zjztz from plan_zjxd z left join plan_wqgz p on z.xmid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='1' and p.jgzt='0') zj1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_wqgz g left join plan_wqgz p on g.jhid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='1' and p.jgzt='0') zj2,
		(select count(distinct p.id) zjsl from plan_zjxd z left join plan_wqgz p on z.xmid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='1' and p.jgzt='0') zj3,
		(select nvl(sum(z.xdzj),0) wgztz from plan_zjxd z left join plan_wqgz p on z.xmid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='1' and p.jgzt='1') wg1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wgwc from gcgl_wqgz g left join plan_wqgz p on g.jhid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='1' and p.jgzt='1') wg2,
		(select count(distinct p.id) wgsl from plan_zjxd z left join plan_wqgz p on z.xmid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='1' and p.jgzt='1') wg3
		union all
		select '灾害防治' xmlx,wkg1.*,wkg2.*,zj1.*,zj2.*,zj3.*,wg1.*,wg2.*,wg3.*,
		(wkgztz+zjztz+wgztz) ztz,(zjwc+wgwc) wctz,(wkgsl+zjsl+wgsl) sl from
		(select nvl(sum(z.xdzj),0) wkgztz from plan_zjxd z left join plan_zhfz p on z.xmid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='0') wkg1,
		(select count(distinct p.id) wkgsl from plan_zjxd z left join plan_zhfz p on z.xmid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='0') wkg2,
		(select nvl(sum(z.xdzj),0) zjztz from plan_zjxd z left join plan_zhfz p on z.xmid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='1' and p.jgzt='0') zj1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_zhfz g left join plan_zhfz p on g.jhid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='1' and p.jgzt='0') zj2,
		(select count(distinct p.id) zjsl from plan_zjxd z left join plan_zhfz p on z.xmid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='1' and p.jgzt='0') zj3,
		(select nvl(sum(z.xdzj),0) wgztz from plan_zjxd z left join plan_zhfz p on z.xmid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='1' and p.jgzt='1') wg1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wgwc from gcgl_zhfz g left join plan_zhfz p on g.jhid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='1' and p.jgzt='1') wg2,
		(select count(distinct p.id) wgsl from plan_zjxd z left join plan_zhfz p on z.xmid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id
		where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf} and p.kgzt='1' and p.jgzt='1') wg3
		union all
		select '改建工程' xmlx,wkg1.*,wkg2.*,zj1.*,zj2.*,zj3.*,wg1.*,wg2.*,wg3.*,
		(wkgztz+zjztz+wgztz) ztz,(zjwc+wgwc) wctz,(wkgsl+zjsl+wgsl) sl from 
		(select nvl(sum(z.xdzj),0) wkgztz from jhsh_sjgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='0') wkg1,
		(select count(distinct j.xmbm) wkgsl from jhsh_sjgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='0') wkg2,
		(select nvl(sum(z.xdzj),0) zjztz from jhsh_sjgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj1,
		(select nvl(sum(g.bywctze),0) zjwc from gcgl_gcgzsj g left join jhsh_sjgz j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj2,
		(select count(distinct j.xmbm) zjsl from jhsh_sjgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj3,
		(select nvl(sum(z.xdzj),0) wgztz from jhsh_sjgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg1,
		(select nvl(sum(g.bywctze),0) wgwc from gcgl_gcgzsj g left join jhsh_sjgz j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg2,
		(select count(distinct j.xmbm) wgsl from jhsh_sjgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg3
		union all
		select '路面改造工程' xmlx,wkg1.*,wkg2.*,zj1.*,zj2.*,zj3.*,wg1.*,wg2.*,wg3.*,
		(wkgztz+zjztz+wgztz) ztz,(zjwc+wgwc) wctz,(wkgsl+zjsl+wgsl) sl from 
		(select nvl(sum(z.xdzj),0) wkgztz from jhsh_lmgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='0') wkg1,
		(select count(distinct j.xmbm) wkgsl from jhsh_lmgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='0') wkg2,
		(select nvl(sum(z.xdzj),0) zjztz from jhsh_lmgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_gcgzgj g left join jhsh_lmgz j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj2,
		(select count(distinct j.xmbm) zjsl from jhsh_lmgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj3,
		(select nvl(sum(z.xdzj),0) wgztz from jhsh_lmgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wgwc from gcgl_gcgzgj g left join jhsh_lmgz j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg2,
		(select count(distinct j.xmbm) wgsl from jhsh_lmgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg3
		union all
		select '新建工程' xmlx,wkg1.*,wkg2.*,zj1.*,zj2.*,zj3.*,wg1.*,wg2.*,wg3.*,
		(wkgztz+zjztz+wgztz) ztz,(zjwc+wgwc) wctz,(wkgsl+zjsl+wgsl) sl from 
		(select nvl(sum(z.xdzj),0) wkgztz from jhsh_xj j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='0') wkg1,
		(select count(distinct j.xmbm) wkgsl from jhsh_xj j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='0') wkg2,
		(select nvl(sum(z.xdzj),0) zjztz from jhsh_xj j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_xj g left join jhsh_xj j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj2,
		(select count(distinct j.xmbm) zjsl from jhsh_xj j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj3,
		(select nvl(sum(z.xdzj),0) wgztz from jhsh_xj j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wgwc from gcgl_xj g left join jhsh_xj j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg2,
		(select count(distinct j.xmbm) wgsl from jhsh_xj j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg3
		union all
		select '养护大中修工程' xmlx,wkg1.*,wkg2.*,zj1.*,zj2.*,zj3.*,wg1.*,wg2.*,wg3.*,
		(wkgztz+zjztz+wgztz) ztz,(zjwc+wgwc) wctz,(wkgsl+zjsl+wgsl) sl from 
		(select nvl(sum(z.xdzj),0) wkgztz from jhsh_yhdzx j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='0') wkg1,
		(select count(distinct j.xmbm) wkgsl from jhsh_yhdzx j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='0') wkg2,
		(select nvl(sum(z.xdzj),0) zjztz from jhsh_yhdzx j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_yhdzx g left join jhsh_yhdzx j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj2,
		(select count(distinct j.xmbm) zjsl from jhsh_yhdzx j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj3,
		(select nvl(sum(z.xdzj),0) wgztz from jhsh_yhdzx j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wgwc from gcgl_yhdzx g left join jhsh_yhdzx j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg2,
		(select count(distinct j.xmbm) wgsl from jhsh_yhdzx j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg3
		union all
		select '灾毁重建' xmlx,wkg1.*,wkg2.*,zj1.*,zj2.*,zj3.*,wg1.*,wg2.*,wg3.*,
		(wkgztz+zjztz+wgztz) ztz,(zjwc+wgwc) wctz,(wkgsl+zjsl+wgsl) sl from 
		(select nvl(sum(z.xdzj),0) wkgztz from jhsh_sh j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='0') wkg1,
		(select count(distinct j.xmbm) wkgsl from jhsh_sh j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='0') wkg2,
		(select nvl(sum(z.xdzj),0) zjztz from jhsh_sh j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_sh g left join jhsh_sh j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj2,
		(select count(distinct j.xmbm) zjsl from jhsh_sh j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj3,
		(select nvl(sum(z.xdzj),0) wgztz from jhsh_sh j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg1,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wgwc from gcgl_sh g left join jhsh_sh j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg2,
		(select count(distinct j.xmbm) wgsl from jhsh_sh j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg3
	</select>
	<select id="queryGckXmlxTjtLstz" resultType="java.util.Map" parameterType="java.util.Map">
		<![CDATA[
		select '安保工程' xmlx,wkg1.*,wkg2.*,zj1.*,zj2.*,zj3.*,wg1.*,wg2.*,wg3.*,
	    (wkgztz+zjztz+wgztz) ztz,(zjwc+wgwc) wctz,(wkgsl+zjsl+wgsl) sl from
	    (select nvl(sum(z.xdzj),0) wkgztz from plan_zjxd z left join plan_abgc p on z.xmid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id
	    where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf<${nf} and p.kgzt='0') wkg1,
	    (select count(distinct p.id) wkgsl from plan_zjxd z left join plan_abgc p on z.xmid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id
	    where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf<${nf} and p.kgzt='0') wkg2,
	    (select nvl(sum(z.xdzj),0) zjztz from plan_zjxd z left join plan_abgc p on z.xmid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id
	    where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf<${nf} and p.kgzt='1' and p.jgzt='0') zj1,
	    (select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_abgc g left join plan_abgc p on g.jhid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id
	    where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf<${nf} and p.kgzt='1' and p.jgzt='0') zj2,
	    (select count(distinct p.id) zjsl from plan_zjxd z left join plan_abgc p on z.xmid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id
	    where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf<${nf} and p.kgzt='1' and p.jgzt='0') zj3,
	    (select nvl(sum(z.xdzj),0) wgztz from plan_zjxd z left join plan_abgc p on z.xmid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id
	    where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf<${nf} and p.kgzt='1' and p.jgzt='1') wg1,
	    (select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wgwc from gcgl_abgc g left join plan_abgc p on g.jhid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id
	    where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf<${nf} and p.kgzt='1' and p.jgzt='1') wg2,
	    (select count(distinct p.id) wgsl from plan_zjxd z left join plan_abgc p on z.xmid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id
	    where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf<${nf} and p.kgzt='1' and p.jgzt='1') wg3
	    union all
	    select '危桥改造' xmlx,wkg1.*,wkg2.*,zj1.*,zj2.*,zj3.*,wg1.*,wg2.*,wg3.*,
	    (wkgztz+zjztz+wgztz) ztz,(zjwc+wgwc) wctz,(wkgsl+zjsl+wgsl) sl from
	    (select nvl(sum(z.xdzj),0) wkgztz from plan_zjxd z left join plan_wqgz p on z.xmid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id
	    where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf<${nf} and p.kgzt='0') wkg1,
	    (select count(distinct p.id) wkgsl from plan_zjxd z left join plan_wqgz p on z.xmid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id
	    where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf<${nf} and p.kgzt='0') wkg2,
	    (select nvl(sum(z.xdzj),0) zjztz from plan_zjxd z left join plan_wqgz p on z.xmid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id
	    where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf<${nf} and p.kgzt='1' and p.jgzt='0') zj1,
	    (select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_wqgz g left join plan_wqgz p on g.jhid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id
	    where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf<${nf} and p.kgzt='1' and p.jgzt='0') zj2,
	    (select count(distinct p.id) zjsl from plan_zjxd z left join plan_wqgz p on z.xmid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id
	    where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf<${nf} and p.kgzt='1' and p.jgzt='0') zj3,
	    (select nvl(sum(z.xdzj),0) wgztz from plan_zjxd z left join plan_wqgz p on z.xmid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id
	    where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf<${nf} and p.kgzt='1' and p.jgzt='1') wg1,
	    (select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wgwc from gcgl_wqgz g left join plan_wqgz p on g.jhid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id
	    where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf<${nf} and p.kgzt='1' and p.jgzt='1') wg2,
	    (select count(distinct p.id) wgsl from plan_zjxd z left join plan_wqgz p on z.xmid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id
	    where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf<${nf} and p.kgzt='1' and p.jgzt='1') wg3
	    union all
	    select '灾害防治' xmlx,wkg1.*,wkg2.*,zj1.*,zj2.*,zj3.*,wg1.*,wg2.*,wg3.*,
	    (wkgztz+zjztz+wgztz) ztz,(zjwc+wgwc) wctz,(wkgsl+zjsl+wgsl) sl from
	    (select nvl(sum(z.xdzj),0) wkgztz from plan_zjxd z left join plan_zhfz p on z.xmid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id
	    where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf<${nf} and p.kgzt='0') wkg1,
	    (select count(distinct p.id) wkgsl from plan_zjxd z left join plan_zhfz p on z.xmid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id
	    where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf<${nf} and p.kgzt='0') wkg2,
	    (select nvl(sum(z.xdzj),0) zjztz from plan_zjxd z left join plan_zhfz p on z.xmid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id
	    where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf<${nf} and p.kgzt='1' and p.jgzt='0') zj1,
	    (select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_zhfz g left join plan_zhfz p on g.jhid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id
	    where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf<${nf} and p.kgzt='1' and p.jgzt='0') zj2,
	    (select count(distinct p.id) zjsl from plan_zjxd z left join plan_zhfz p on z.xmid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id
	    where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf<${nf} and p.kgzt='1' and p.jgzt='0') zj3,
	    (select nvl(sum(z.xdzj),0) wgztz from plan_zjxd z left join plan_zhfz p on z.xmid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id
	    where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf<${nf} and p.kgzt='1' and p.jgzt='1') wg1,
	    (select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wgwc from gcgl_zhfz g left join plan_zhfz p on g.jhid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id
	    where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf<${nf} and p.kgzt='1' and p.jgzt='1') wg2,
	    (select count(distinct p.id) wgsl from plan_zjxd z left join plan_zhfz p on z.xmid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id
	    where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf<${nf} and p.kgzt='1' and p.jgzt='1') wg3
	    union all
	    select '改建工程' xmlx,wkg1.*,wkg2.*,zj1.*,zj2.*,zj3.*,wg1.*,wg2.*,wg3.*,
	    (wkgztz+zjztz+wgztz) ztz,(zjwc+wgwc) wctz,(wkgsl+zjsl+wgsl) sl from 
	    (select nvl(sum(z.xdzj),0) wkgztz from jhsh_sjgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='0') wkg1,
	    (select count(distinct j.xmbm) wkgsl from jhsh_sjgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='0') wkg2,
	    (select nvl(sum(z.xdzj),0) zjztz from jhsh_sjgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj1,
	    (select nvl(sum(g.bywctze),0) zjwc from gcgl_gcgzsj g left join jhsh_sjgz j on g.jhid=j.xmbm where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj2,
	    (select count(distinct j.xmbm) zjsl from jhsh_sjgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj3,
	    (select nvl(sum(z.xdzj),0) wgztz from jhsh_sjgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg1,
	    (select nvl(sum(g.bywctze),0) wgwc from gcgl_gcgzsj g left join jhsh_sjgz j on g.jhid=j.xmbm where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg2,
	    (select count(distinct j.xmbm) wgsl from jhsh_sjgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg3
	    union all
	    select '路面改造工程' xmlx,wkg1.*,wkg2.*,zj1.*,zj2.*,zj3.*,wg1.*,wg2.*,wg3.*,
	    (wkgztz+zjztz+wgztz) ztz,(zjwc+wgwc) wctz,(wkgsl+zjsl+wgsl) sl from 
	    (select nvl(sum(z.xdzj),0) wkgztz from jhsh_lmgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='0') wkg1,
	    (select count(distinct j.xmbm) wkgsl from jhsh_lmgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='0') wkg2,
	    (select nvl(sum(z.xdzj),0) zjztz from jhsh_lmgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj1,
	    (select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_gcgzgj g left join jhsh_lmgz j on g.jhid=j.xmbm where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj2,
	    (select count(distinct j.xmbm) zjsl from jhsh_lmgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj3,
	    (select nvl(sum(z.xdzj),0) wgztz from jhsh_lmgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg1,
	    (select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wgwc from gcgl_gcgzgj g left join jhsh_lmgz j on g.jhid=j.xmbm where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg2,
	    (select count(distinct j.xmbm) wgsl from jhsh_lmgz j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg3
	    union all
	    select '新建工程' xmlx,wkg1.*,wkg2.*,zj1.*,zj2.*,zj3.*,wg1.*,wg2.*,wg3.*,
	    (wkgztz+zjztz+wgztz) ztz,(zjwc+wgwc) wctz,(wkgsl+zjsl+wgsl) sl from 
	    (select nvl(sum(z.xdzj),0) wkgztz from jhsh_xj j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='0') wkg1,
	    (select count(distinct j.xmbm) wkgsl from jhsh_xj j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='0') wkg2,
	    (select nvl(sum(z.xdzj),0) zjztz from jhsh_xj j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj1,
	    (select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_xj g left join jhsh_xj j on g.jhid=j.xmbm where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj2,
	    (select count(distinct j.xmbm) zjsl from jhsh_xj j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj3,
	    (select nvl(sum(z.xdzj),0) wgztz from jhsh_xj j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg1,
	    (select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wgwc from gcgl_xj g left join jhsh_xj j on g.jhid=j.xmbm where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg2,
	    (select count(distinct j.xmbm) wgsl from jhsh_xj j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg3
	    union all
	    select '养护大中修工程' xmlx,wkg1.*,wkg2.*,zj1.*,zj2.*,zj3.*,wg1.*,wg2.*,wg3.*,
	    (wkgztz+zjztz+wgztz) ztz,(zjwc+wgwc) wctz,(wkgsl+zjsl+wgsl) sl from 
	    (select nvl(sum(z.xdzj),0) wkgztz from jhsh_yhdzx j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='0') wkg1,
	    (select count(distinct j.xmbm) wkgsl from jhsh_yhdzx j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='0') wkg2,
	    (select nvl(sum(z.xdzj),0) zjztz from jhsh_yhdzx j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj1,
	    (select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_yhdzx g left join jhsh_yhdzx j on g.jhid=j.xmbm where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj2,
	    (select count(distinct j.xmbm) zjsl from jhsh_yhdzx j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj3,
	    (select nvl(sum(z.xdzj),0) wgztz from jhsh_yhdzx j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg1,
	    (select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wgwc from gcgl_yhdzx g left join jhsh_yhdzx j on g.jhid=j.xmbm where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg2,
	    (select count(distinct j.xmbm) wgsl from jhsh_yhdzx j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg3
	    union all
	    select '灾毁重建' xmlx,wkg1.*,wkg2.*,zj1.*,zj2.*,zj3.*,wg1.*,wg2.*,wg3.*,
	    (wkgztz+zjztz+wgztz) ztz,(zjwc+wgwc) wctz,(wkgsl+zjsl+wgsl) sl from 
	    (select nvl(sum(z.xdzj),0) wkgztz from jhsh_sh j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='0') wkg1,
	    (select count(distinct j.xmbm) wkgsl from jhsh_sh j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='0') wkg2,
	    (select nvl(sum(z.xdzj),0) zjztz from jhsh_sh j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj1,
	    (select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_sh g left join jhsh_sh j on g.jhid=j.xmbm where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj2,
	    (select count(distinct j.xmbm) zjsl from jhsh_sh j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='0') zj3,
	    (select nvl(sum(z.xdzj),0) wgztz from jhsh_sh j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg1,
	    (select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wgwc from gcgl_sh g left join jhsh_sh j on g.jhid=j.xmbm where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg2,
	    (select count(distinct j.xmbm) wgsl from jhsh_sh j left join plan_zjxd z on j.xmbm=z.xmid where j.xmbm like '%'||#{xzqhdm}||'%' and substr(j.xmbm,0,4)<${nf} and j.xdzt='1' and j.kgzt='1' and j.jgzt='1') wg3
	    ]]>
	</select>
	<select id="queryTzebl" resultType="java.util.Map" parameterType="java.util.Map">
		select sum(bnwc) bnwc,sum(snwc) snwc,round((sum(bnwc)-sum(snwc))/sum(snwc),2) bl from (
		select bnwc,snwc from 
		(select nvl(sum(g.wc_btz), 0) + nvl(sum(g.wc_stz), 0) + nvl(sum(g.wc_qttz), 0) bnwc from gcgl_gcgzgj g left join jhsh_lmgz j on g.jhid = j.xmbm 
		where j.xmbm like #{bn} || #{xzqhdm} || '%' and j.xdzt = '1') gjbn,
		(select nvl(sum(g.wc_btz), 0) + nvl(sum(g.wc_stz), 0) + nvl(sum(g.wc_qttz), 0) snwc from gcgl_gcgzgj g left join jhsh_lmgz j on g.jhid = j.xmbm 
		where j.xmbm like #{sn} || #{xzqhdm} || '%' and j.xdzt = '1') gjsn
		union all
		select * from 
		(select nvl(sum(g.bywctze),0) bnwc from gcgl_gcgzsj g left join jhsh_sjgz j on g.jhid=j.xmbm 
		where j.xmbm like #{bn}||#{xzqhdm}||'%' and j.xdzt='1') sjbn,
		(select nvl(sum(g.bywctze),0) snwc from gcgl_gcgzsj g left join jhsh_sjgz j on g.jhid=j.xmbm 
		where j.xmbm like #{sn}||#{xzqhdm}||'%' and j.xdzt='1') sjsn
		union all
		select * from 
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_xj g left join jhsh_xj j on g.jhid=j.xmbm 
		where j.xmbm like #{bn}||#{xzqhdm}||'%' and j.xdzt='1') xjbn,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_xj g left join jhsh_xj j on g.jhid=j.xmbm 
		where j.xmbm like #{sn}||#{xzqhdm}||'%' and j.xdzt='1') xjsn
		union all
		select * from
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_yhdzx g left join jhsh_yhdzx j on g.jhid=j.xmbm 
		where j.xmbm like #{bn}||#{xzqhdm}||'%' and j.xdzt='1') yhbn,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_yhdzx g left join jhsh_yhdzx j on g.jhid=j.xmbm 
		where j.xmbm like #{sn}||#{xzqhdm}||'%' and j.xdzt='1') yhsn
		union all
		select * from 
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_sh g left join jhsh_sh j on g.jhid=j.xmbm 
		where j.xmbm like #{bn}||#{xzqhdm}||'%' and j.xdzt='1') shbn,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_sh g left join jhsh_sh j on g.jhid=j.xmbm 
		where j.xmbm like #{sn}||#{xzqhdm}||'%' and j.xdzt='1') shsn
		union all
		select * from
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) bnwc from gcgl_abgc g left join plan_abgc p on g.jhid=p.id 
		left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf=#{bn}) abbn,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) snwc from gcgl_abgc g left join plan_abgc p on g.jhid=p.id 
		left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf=#{sn}) absn
		union all
		select * from
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) bnwc from gcgl_zhfz g left join plan_zhfz p on g.jhid=p.id 
		left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{bn}) zhbn,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) snwc from gcgl_zhfz g left join plan_zhfz p on g.jhid=p.id 
		left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{sn}) zhsn
		union all
		select * from
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) bnwc from gcgl_wqgz g left join plan_wqgz p on g.jhid=p.id 
		left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{bn}) wqbn,
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) snwc from gcgl_wqgz g left join plan_wqgz p on g.jhid=p.id 
		left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{sn}) wqsn)
	</select>
	<select id="queryGckLcWcbl" resultType="java.util.Map" parameterType="java.util.Map">
		select nvl(sum(bywc),0) wclc,sum(zlc) zlc,case when sum(zlc)=0 then 0 else trunc(nvl(sum(bywc),0)/sum(zlc),2) end bl from (
		select * from 
		(select sum(g.bywcmc) bywc from gcgl_gcgzsj g where g.jhid in (select xmbm from jhsh_sjgz j where j.xdzt='1' and j.xmbm like #{nf}||#{xzqhdm}||'%')) sj1,
		(select sum(l.lc) zlc from jhsh_sjgz j left join lxsh_lx l on j.xmbm=l.xmid where j.xdzt='1' and l.jdbs='2' and j.xmbm like #{nf}||#{xzqhdm}||'%') sj2
		union all
		select * from
		(select nvl(sum(g.bywcmc),0) from gcgl_gcgzgj g where g.jhid in (select xmbm from jhsh_lmgz j where j.xdzt = '1'and j.xmbm like #{nf}||#{xzqhdm}||'%')) gj1,
		(select sum(l.lc) zlc from jhsh_lmgz j left join lxsh_lx l on j.xmbm=l.xmid where j.xdzt = '1'and j.xmbm like #{nf}||#{xzqhdm}||'%') gj2
		union all
		select * from
		(select nvl(sum(g.bywcmc), 0) from gcgl_xj g where g.jhid in (select xmbm from jhsh_xj j where j.xdzt = '1'and j.xmbm like #{nf}||#{xzqhdm}||'%')) xj1,
		(select sum(l.lc) from jhsh_xj j left join lxsh_lx l on j.xmbm=l.xmid where j.xdzt = '1'and j.xmbm like #{nf}||#{xzqhdm}||'%') xj2
		union all
		select * from 
		(select nvl(sum(g.bywcmc), 0) from gcgl_yhdzx g where g.jhid in (select xmbm from jhsh_yhdzx j where j.xdzt = '1'and j.xmbm like #{nf}||#{xzqhdm}||'%')) yh1,
		(select sum(l.lc) from jhsh_yhdzx j left join lxsh_lx l on j.xmbm=l.xmid where j.xdzt = '1'and j.xmbm like #{nf}||#{xzqhdm}||'%')
		union all
		select * from
		(select nvl(sum(g.bywcmc), 0) from gcgl_sh g where g.jhid in (select xmbm from jhsh_sh j where j.xdzt = '1'and j.xmbm like #{nf}||#{xzqhdm}||'%')) sh1,
		(select sum(l.lc) from jhsh_sh j left join lxsh_lx l on j.xmbm=l.xmid where j.xdzt = '1'and j.xmbm like #{nf}||#{xzqhdm}||'%')
		union all
		select * from
		(select nvl(sum(g.bywc_gl), 0) from gcgl_abgc g where g.jhid in (select j.id from plan_abgc j left join sck_abgc s on j.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id where j.jhnf=#{nf} and x.xzqhdm like #{xzqhdm}||'%')) ab1,
		(select nvl(sum(j.jhzlc),0) from plan_abgc j left join sck_abgc s on j.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id where j.jhnf=#{nf} and x.xzqhdm like #{xzqhdm}||'%') ab2
		union all
		select * from
		(select nvl(sum(g.bywcgl), 0) from gcgl_zhfz g where g.jhid in (select j.id from plan_zhfz j left join sck_zhfz s on j.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id where j.sbnf=#{nf} and x.xzqhdm like #{xzqhdm}||'%')) zh1,
		(select nvl(sum(j.jhzlc),0) from plan_zhfz j left join sck_zhfz s on j.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id where j.sbnf=#{nf} and x.xzqhdm like #{xzqhdm}||'%') zh2
		)
	</select>
	<select id="queryGckCgsWcbl" resultType="java.util.Map" parameterType="java.util.Map">
		select sum(dwcgs) dwcgs,sum(cgs) cgs,case when sum(cgs)=0 then 0 else trunc(sum(dwcgs)/sum(cgs),2) end bl from (
		select * from
		(select nvl(sum(g.zycgs),0) dwcgs from gcgl_gcgzsj g where g.jhid in (select xmbm from jhsh_sjgz j where j.xdzt='1' and j.xmbm like #{nf}||#{xzqhdm}||'%')) sj1,
		(select sum(j.bbzzj) cgs from jhsh_sjgz j where j.xdzt='1' and j.xmbm like #{nf}||#{xzqhdm}||'%')
		union all
		select * from
		(select nvl(sum(g.zjdw_btz),0) dwcgs from gcgl_gcgzgj g where g.jhid in (select xmbm from jhsh_lmgz j where j.xdzt='1' and j.xmbm like #{nf}||#{xzqhdm}||'%')) sj1,
		(select sum(j.bbzzj) cgs from jhsh_lmgz j where j.xdzt='1' and j.xmbm like #{nf}||#{xzqhdm}||'%')
		union all
		select * from
		(select nvl(sum(g.zjdw_btz),0) dwcgs from gcgl_xj g where g.jhid in (select xmbm from jhsh_xj j where j.xdzt='1' and j.xmbm like #{nf}||#{xzqhdm}||'%')) sj1,
		(select sum(j.bbzzj) cgs from jhsh_xj j where j.xdzt='1' and j.xmbm like #{nf}||#{xzqhdm}||'%')
		union all
		select * from
		(select nvl(sum(g.zjdw_btz),0) dwcgs from gcgl_yhdzx g where g.jhid in (select xmbm from jhsh_yhdzx j where j.xdzt='1' and j.xmbm like #{nf}||#{xzqhdm}||'%')) sj1,
		(select sum(j.yqdbcgs) cgs from jhsh_yhdzx j where j.xdzt='1' and j.xmbm like #{nf}||#{xzqhdm}||'%')
		union all
		select * from
		(select nvl(sum(g.zjdw_btz),0) dwcgs from gcgl_sh g where g.jhid in (select xmbm from jhsh_sh j where j.xdzt='1' and j.xmbm like #{nf}||#{xzqhdm}||'%')) sj1,
		(select sum(j.bbzzj) cgs from jhsh_sh j where j.xdzt='1' and j.xmbm like #{nf}||#{xzqhdm}||'%')
		union all
		select * from
		(select nvl(sum(g.zjdw_btz), 0) dwcgs from gcgl_abgc g where g.jhid in (select j.id from plan_abgc j left join sck_abgc s on j.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id where j.jhnf=#{nf} and x.xzqhdm like #{xzqhdm}||'%')) ab1,
		(select nvl(sum(j.jhsybbzje),0) cgs from plan_abgc j left join sck_abgc s on j.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id where j.jhnf=#{nf} and x.xzqhdm like #{xzqhdm}||'%') ab2
		union all
		select * from
		(select nvl(sum(g.zjdw_btz), 0) dwcgs from gcgl_zhfz g where g.jhid in (select j.id from plan_zhfz j left join sck_zhfz s on j.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id where j.sbnf=#{nf} and x.xzqhdm like #{xzqhdm}||'%')) zh1,
		(select nvl(sum(j.jhsybzje),0) cgs from plan_zhfz j left join sck_zhfz s on j.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id where j.sbnf=#{nf} and x.xzqhdm like #{xzqhdm}||'%') zh2
		union all
		select * from
		(select nvl(sum(g.zjdw_btz), 0) dwcgs from gcgl_wqgz g where g.jhid in (select j.id from plan_wqgz j left join sck_wqgz s on j.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id where j.sbnf=#{nf} and x.xzqhdm like #{xzqhdm}||'%')) zh1,
		(select nvl(sum(j.jhsybzje),0) cgs from plan_wqgz j left join sck_wqgz s on j.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id where j.sbnf=#{nf} and x.xzqhdm like #{xzqhdm}||'%') zh2
		)
	</select>
	<select id="queryGckTzWcbl" resultType="java.util.Map" parameterType="java.util.Map">
		select sum(wctz) wctz,sum(ztz) ztz,case when sum(ztz)=0 then 0 else trunc(sum(wctz)/sum(ztz),2) end bl from(
		select * from
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wctz from gcgl_gcgzgj g left join jhsh_lmgz j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1'),
		(select sum(j.pfztz) ztz from jhsh_lmgz j where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1')
		union all
		select * from
		(select nvl(sum(g.bywctze),0) zjwc from gcgl_gcgzsj g left join jhsh_sjgz j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1'),
		(select sum(j.pfztz) ztz from jhsh_sjgz j where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1')
		union all
		select * from
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wctz from gcgl_xj g left join jhsh_xj j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1'),
		(select sum(j.pfztz) from jhsh_xj j where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1')
		union all
		select * from
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_yhdzx g left join jhsh_yhdzx j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1'),
		(select sum(j.ztz) from jhsh_yhdzx j where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1')
		union all
		select * from 
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) zjwc from gcgl_sh g left join jhsh_sh j on g.jhid=j.xmbm where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1'),
		(select sum(j.pfztz) from jhsh_sh j where j.xmbm like #{nf}||#{xzqhdm}||'%' and j.xdzt='1')
		union all
		select * from
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wctz from gcgl_zhfz g left join plan_zhfz p on g.jhid=p.id left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf}),
		(select nvl(sum(p.pfztz),0) ztz from plan_zhfz p left join sck_zhfz s on p.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf})
		union all
		select * from
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wctz from gcgl_abgc g left join plan_abgc p on g.jhid=p.id left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf=#{nf}),
		(select nvl(sum(p.pfztz),0) ztz from plan_abgc p left join sck_abgc s on p.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id where x.xzqhdm like #{xzqhdm}||'%' and p.jhnf=#{nf})
		union all
		select * from
		(select nvl(sum(g.wc_btz),0)+nvl(sum(g.wc_stz),0)+nvl(sum(g.wc_qttz),0) wctz from gcgl_wqgz g left join plan_wqgz p on g.jhid=p.id left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf}),
		(select nvl(sum(p.pfztz),0) ztz from plan_wqgz p left join sck_wqgz s on p.sckid=s.sckid left join xmk_wqgz x on s.xmkid=x.id where x.xzqhdm like #{xzqhdm}||'%' and p.sbnf=#{nf})
		)
	</select>
	<select id="queryGckJhgcltj" resultType="java.util.Map" parameterType="java.util.Map">
		select nvl(sum(bywc),0) wclc,sum(zlc) zlc from (
		    select * from 
		    (select sum(g.bywcmc) bywc from gcgl_gcgzsj g where g.jhid in (select xmbm from jhsh_sjgz j where j.xdzt='1' and j.xmbm like #{nf}||#{xzqhdm}||'%')) sj1,
		    (select sum(l.lc) zlc from jhsh_sjgz j left join lxsh_lx l on j.xmbm=l.xmid where j.xdzt='1' and l.jdbs='2' and j.xmbm like #{nf}||#{xzqhdm}||'%') sj2
		    union all
		    select * from
		    (select nvl(sum(g.bywcmc),0) from gcgl_gcgzgj g where g.jhid in (select xmbm from jhsh_lmgz j where j.xdzt = '1'and j.xmbm like #{nf}||#{xzqhdm}||'%')) gj1,
		    (select sum(l.lc) zlc from jhsh_lmgz j left join lxsh_lx l on j.xmbm=l.xmid where j.xdzt = '1'and j.xmbm like #{nf}||#{xzqhdm}||'%') gj2
		    union all
		    select * from
		    (select nvl(sum(g.bywcmc), 0) from gcgl_xj g where g.jhid in (select xmbm from jhsh_xj j where j.xdzt = '1'and j.xmbm like #{nf}||#{xzqhdm}||'%')) xj1,
		    (select sum(l.lc) from jhsh_xj j left join lxsh_lx l on j.xmbm=l.xmid where j.xdzt = '1'and j.xmbm like #{nf}||#{xzqhdm}||'%') xj2
		    union all
		    select * from 
		    (select nvl(sum(g.bywcmc), 0) from gcgl_yhdzx g where g.jhid in (select xmbm from jhsh_yhdzx j where j.xdzt = '1'and j.xmbm like #{nf}||#{xzqhdm}||'%')) yh1,
		    (select sum(l.lc) from jhsh_yhdzx j left join lxsh_lx l on j.xmbm=l.xmid where j.xdzt = '1'and j.xmbm like #{nf}||#{xzqhdm}||'%')
		    union all
		    select * from
		    (select nvl(sum(g.bywcmc), 0) from gcgl_sh g where g.jhid in (select xmbm from jhsh_sh j where j.xdzt = '1'and j.xmbm like #{nf}||#{xzqhdm}||'%')) sh1,
		    (select sum(l.lc) from jhsh_sh j left join lxsh_lx l on j.xmbm=l.xmid where j.xdzt = '1'and j.xmbm like #{nf}||#{xzqhdm}||'%')
		    union all
		    select * from
		    (select nvl(sum(g.bywc_gl), 0) from gcgl_abgc g where g.jhid in (select j.id from plan_abgc j left join sck_abgc s on j.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id where j.jhnf=#{nf} and x.xzqhdm like #{xzqhdm}||'%')) ab1,
		    (select nvl(sum(j.jhzlc),0) from plan_abgc j left join sck_abgc s on j.sckid=s.sckid left join xmk_abgc x on s.xmkid=x.id where j.jhnf=#{nf} and x.xzqhdm like #{xzqhdm}||'%') ab2
		    union all
		    select * from
		    (select nvl(sum(g.bywcgl), 0) from gcgl_zhfz g where g.jhid in (select j.id from plan_zhfz j left join sck_zhfz s on j.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id where j.sbnf=#{nf} and x.xzqhdm like #{xzqhdm}||'%')) zh1,
		    (select nvl(sum(j.jhzlc),0) from plan_zhfz j left join sck_zhfz s on j.sckid=s.sckid left join xmk_zhfz x on s.xmkid=x.id where j.sbnf=#{nf} and x.xzqhdm like #{xzqhdm}||'%') zh2
		)
	</select>
	<select id="queryJcktj" resultType="java.util.Map" parameterType="java.util.Map">
		select * from 
		(select nvl(sum(a.yhlc),0) ablczj,count(a.id) abxmzj from xmk_abgc a where a.xzqhdm like #{xzqhdm}||'%' and a.xmnf=#{nf}),
		(select nvl(sum(z.yhlc),0) zhlczj,count(z.id) zhxmzj from xmk_zhfz z where z.xzqhdm like #{xzqhdm}||'%' and z.xmnf=#{nf}),
		(select nvl(sum(w.qlqc),0) wqlczj,count(w.id) wqxmzj from xmk_wqgz w where w.xzqhdm like #{xzqhdm}||'%' and w.xmnf=#{nf})
	</select>
	
	<select id="queryLkpdmx" resultType="lkmxb" parameterType="java.util.Map">
	select * from 
			(
				select rownum as num,t.* from 
				(
		select t.*,'K'||qdzh||'-K'||zdzh zh,(zdzh-qdzh)*1000 cd 
		from LKPD_MXB_DATA_2014  t left join lkpd_mxb2014 m on t.mxb_id=m.id
		where 1=1 
		<if test="lkmxb.jsdj != null and  lkmxb.jsdj != ''">
			and jsdj = #{lkmxb.jsdj}
		</if>
		<if test="lkmxb.lmlx != null and  lkmxb.lmlx != ''">
			and lmlx = #{lkmxb.lmlx}
		</if>
		<if test="lkmxb.jcfx != null and  lkmxb.jcfx != ''">
			and jcfx = #{lkmxb.jcfx}
		</if>
		<if test="lkmxb.lxbh != null and  lkmxb.lxbh != ''">
			${lkmxb.lxbh}
		</if>
		<if test="lkmxb.tbnf != null and  lkmxb.tbnf != ''">
		    and m.tbnf=#{lkmxb.tbnf} 
		</if>
		<if test="lkmxb.qdzh != null and  lkmxb.qdzh != ''">
			and to_number(t.zdzh) >= to_number(#{lkmxb.qdzh})
		</if> 
		<if test="lkmxb.zdzh != null and  lkmxb.zdzh != ''">
			and to_number(t.qdzh) &lt;= to_number(#{lkmxb.zdzh})
		</if>
		order by lxbh,qdzh
		  ) t
		)
    	where <![CDATA[ num <= (#{page} * #{rows})]]> and num>(#{page}-1)*#{rows}
	</select>
	
	<select id="queryLkpdmxCount" resultType="int" parameterType="lkmxb">
		select count(*)
		from LKPD_MXB_DATA_2014  left join lkpd_mxb2014 m on mxb_id=m.id   
		where 1=1 
		<if test="lkmxb.jsdj != null and  lkmxb.jsdj != ''">
			and jsdj = #{lkmxb.jsdj}
		</if>
		<if test="lkmxb.lmlx != null and  lkmxb.lmlx != ''">
			and lmlx = #{lkmxb.lmlx}
		</if>
		<if test="lkmxb.jcfx != null and  lkmxb.jcfx != ''">
			and jcfx = #{lkmxb.jcfx}
		</if>
		<if test="lkmxb.lxbh != null and  lkmxb.lxbh != ''">
			${lkmxb.lxbh}
		</if>
		<if test="lkmxb.tbnf != null and  lkmxb.tbnf != ''">
			 and m.tbnf=#{lkmxb.tbnf} 
		</if>
		<if test="lkmxb.qdzh != null and  lkmxb.qdzh != ''">
			and to_number(zdzh) >= to_number(#{lkmxb.qdzh})
		</if> 
		<if test="lkmxb.zdzh != null and  lkmxb.zdzh != ''">
			and to_number(qdzh) &lt;= to_number(#{lkmxb.zdzh})
		</if>
		order by lxbh
	</select>
	
	<select id="queryLkpdmxList" resultType="lkmxb" parameterType="java.util.Map">
		select t.*,'K'||qdzh||'-K'||zdzh zh,(zdzh-qdzh)*1000 cd 
		from LKPD_MXB_DATA_2014  t left join lkpd_mxb2014 m on t.mxb_id=m.id
		where 1=1 
		<if test="lkmxb.jsdj != null and  lkmxb.jsdj != ''">
			and jsdj = #{lkmxb.jsdj}
		</if>
		<if test="lkmxb.lmlx != null and  lkmxb.lmlx != ''">
			and lmlx = #{lkmxb.lmlx}
		</if>
		<if test="lkmxb.jcfx != null and  lkmxb.jcfx != ''">
			and jcfx = #{lkmxb.jcfx}
		</if>
		<if test="lkmxb.lxbh != null and  lkmxb.lxbh != ''">
			${lkmxb.lxbh}
		</if>
		<if test="lkmxb.tbnf != null and  lkmxb.tbnf != ''">
		    and m.tbnf=#{lkmxb.tbnf} 
		</if>
		<if test="lkmxb.qdzh != null and  lkmxb.qdzh != ''">
			and to_number(t.zdzh) >= to_number(#{lkmxb.qdzh})
		</if> 
		<if test="lkmxb.zdzh != null and  lkmxb.zdzh != ''">
			and to_number(t.qdzh) &lt;= to_number(#{lkmxb.zdzh})
		</if>
		order by lxbh,qdzh
	</select>
	
	<select id="getLxldCombo" resultType="lkmxb" parameterType="lkmxb">
	select distinct substr(ylxbm,0,length(ylxbm)-6) id,substr(ylxbm,0,length(ylxbm)-6)||'['||t.ylxmc||']' text 
	from ghlx t where ylxbm is not null and ylxmc is not null
    order by substr(ylxbm,0,length(ylxbm)-6)
	</select>
	
	<select id="querylkpdfx" resultType="sjbb" parameterType="lkmxb">
	select c.v_0,c.v_1,c.v_2,c.v_3,c.v_4,c.v_5,
    c.v_6,round((c.v_2+c.v_3)/c.v_1,3)*100 v_7,c.v_8,fn_ReturnFllx(c.v_8) v_9 from (
    select a v_0,sum(cd) v_1,sum(decode(pd,'优',cd,'0')) v_2,sum(decode(pd,'良',cd,'0')) v_3,sum(decode(pd,'中',cd,'0')) v_4,
    sum(decode(pd,'次',cd,'0')) v_5,sum(decode(pd,'差',cd,'0')) v_6,round(avg(MQI1),2) v_8 from(
      select 'MQI' a,sum(zdzh-qdzh) cd,fn_ReturnFllx(mqi) pd,'1' b,SUM(mqi*(zdzh-qdzh))/SUM((zdzh-qdzh)) MQI1 from LKPD_MXB_DATA_2014 t        
              left join lkpd_mxb2014 m on t.mxb_id=m.id  
              where lxbh = #{lkmxb.lxbh}
              <if test="lkmxb.jcfx != null and  lkmxb.jcfx != ''">
				and jcfx = #{lkmxb.jcfx}
			  </if> 
			  <if test="lkmxb.qdzh != null and  lkmxb.qdzh != ''">
				and to_number(zdzh) >= to_number(#{lkmxb.qdzh})
			  </if> 
			  <if test="lkmxb.zdzh != null and  lkmxb.zdzh != ''">
				and to_number(qdzh) &lt;= to_number(#{lkmxb.zdzh})
			  </if> 
			  <if test="lkmxb.tbnf != null and  lkmxb.tbnf != ''">
				 and m.tbnf=#{lkmxb.tbnf} 
			  </if>
              group by fn_ReturnFllx(mqi)
      union all
      select 'PQI' a,sum(zdzh-qdzh) cd,fn_ReturnFllx(pqi) pd,'2' b,SUM(pqi*(zdzh-qdzh))/SUM((zdzh-qdzh)) MQI1 from LKPD_MXB_DATA_2014 t
               left join lkpd_mxb2014 m on t.mxb_id=m.id 
              where lxbh = #{lkmxb.lxbh}
              <if test="lkmxb.jcfx != null and  lkmxb.jcfx != ''">
				and jcfx = #{lkmxb.jcfx}
			  </if> 
			  <if test="lkmxb.qdzh != null and  lkmxb.qdzh != ''">
				and to_number(zdzh) >= to_number(#{lkmxb.qdzh})
			  </if> 
			  <if test="lkmxb.zdzh != null and  lkmxb.zdzh != ''">
				and to_number(qdzh) &lt;= to_number(#{lkmxb.zdzh})
			  </if> 
			   <if test="lkmxb.tbnf != null and  lkmxb.tbnf != ''">
				 and m.tbnf=#{lkmxb.tbnf} 
			  </if>
              group by fn_ReturnFllx(pqi)
      
      union all
      select 'SCI' a,sum(zdzh-qdzh) cd,fn_ReturnFllx(sci) pd,'3' b,SUM(sci*(zdzh-qdzh))/SUM((zdzh-qdzh)) MQI1 from LKPD_MXB_DATA_2014 t
               left join lkpd_mxb2014 m on t.mxb_id=m.id 
               where lxbh = #{lkmxb.lxbh}
              <if test="lkmxb.jcfx != null and  lkmxb.jcfx != ''">
				and jcfx = #{lkmxb.jcfx}
			  </if> 
			  <if test="lkmxb.qdzh != null and  lkmxb.qdzh != ''">
				and to_number(zdzh) >= to_number(#{lkmxb.qdzh})
			  </if> 
			  <if test="lkmxb.zdzh != null and  lkmxb.zdzh != ''">
				and to_number(qdzh) &lt;= to_number(#{lkmxb.zdzh})
			  </if> 
			   <if test="lkmxb.tbnf != null and  lkmxb.tbnf != ''">
				 and m.tbnf=#{lkmxb.tbnf} 
			  </if>
              group by fn_ReturnFllx(sci)
      union all
      select 'BCI' a,sum(zdzh-qdzh) cd,fn_ReturnFllx(bci) pd,'4' b,SUM(bci*(zdzh-qdzh))/SUM((zdzh-qdzh)) MQI1 from LKPD_MXB_DATA_2014 t
               left join lkpd_mxb2014 m on t.mxb_id=m.id 
               where lxbh = #{lkmxb.lxbh}
              <if test="lkmxb.jcfx != null and  lkmxb.jcfx != ''">
				and jcfx = #{lkmxb.jcfx}
			  </if> 
			 <if test="lkmxb.qdzh != null and  lkmxb.qdzh != ''">
				and to_number(zdzh) >= to_number(#{lkmxb.qdzh})
			  </if> 
			  <if test="lkmxb.zdzh != null and  lkmxb.zdzh != ''">
				and to_number(qdzh) &lt;= to_number(#{lkmxb.zdzh})
			  </if>  
			   <if test="lkmxb.tbnf != null and  lkmxb.tbnf != ''">
				 and m.tbnf=#{lkmxb.tbnf} 
			  </if>
              group by fn_ReturnFllx(bci)
      union all
      select 'TCI' a,sum(zdzh-qdzh) cd,fn_ReturnFllx(tci) pd,'5' b,SUM(tci*(zdzh-qdzh))/SUM((zdzh-qdzh)) MQI1 from LKPD_MXB_DATA_2014 t
              left join lkpd_mxb2014 m on t.mxb_id=m.id 
               where lxbh = #{lkmxb.lxbh}
              <if test="lkmxb.jcfx != null and  lkmxb.jcfx != ''">
				and jcfx = #{lkmxb.jcfx}
			  </if> 
			  <if test="lkmxb.qdzh != null and  lkmxb.qdzh != ''">
				and to_number(zdzh) >= to_number(#{lkmxb.qdzh})
			  </if> 
			  <if test="lkmxb.zdzh != null and  lkmxb.zdzh != ''">
				and to_number(qdzh) &lt;= to_number(#{lkmxb.zdzh})
			  </if> 
			   <if test="lkmxb.tbnf != null and  lkmxb.tbnf != ''">
				 and m.tbnf=#{lkmxb.tbnf} 
			  </if>
              group by fn_ReturnFllx(tci)
      ) 
      group by a,b
      order by b
      ) c
	</select>
	
	<select id="querylkbjfx" resultType="sjbb" parameterType="lkmxb">
	select tbnf || '年路况评定' v_0,round(mqi,2) v_1,round(pqi,2) v_2,round(pci,2) v_3,round(rqi,2) v_4,round(sci,2) v_5,round(bci,2) v_6,round(tci,2) v_7,
       round(mqi_sx/cd1_sx,2) v_8,round(mqi_up/cd1_up,2) v_9,round(mqi_down/cd1_down,2) v_10,
       round(pqi_sx/cd2_sx,2) v_11,round(pqi_up/cd2_up,2) v_12,round(pqi_down/cd2_down,2) v_13,
       round(pci_sx/cd3_sx,2) v_14,round(pci_up/cd3_up,2) v_15,round(pci_down/cd3_down,2) v_16,
       round(rqi_sx/cd4_sx,2) v_17,round(rqi_up/cd4_up,2) v_18,round(rqi_down/cd4_down,2) v_19,
       round(sci_sx/cd5_sx,2) v_20,round(sci_up/cd5_up,2) v_21,round(sci_down/cd5_down,2) v_22,
       round(bci_sx/cd6_sx,2) v_23,round(bci_up/cd6_up,2) v_24,round(bci_down/cd6_down,2) v_25,
       round(tci_sx/cd7_sx,2) v_26,round(tci_up/cd7_up,2) v_27,round(tci_down/cd7_down,2) v_28
       from(
       select tbnf,
              sum(decode(jcfx,'双向',mqi*cd,0)) mqi_sx,sum(decode(jcfx,'双向',cd,0)) cd1_sx,
              sum(decode(jcfx,'上行',mqi*cd,0)) mqi_up,sum(decode(jcfx,'上行',cd,0)) cd1_up,
              sum(decode(jcfx,'下行',mqi*cd,0)) mqi_down,sum(decode(jcfx,'下行',cd,0)) cd1_down,
              sum(decode(jcfx,'双向',pqi*cd,0)) pqi_sx,sum(decode(jcfx,'双向',cd,0)) cd2_sx,
              sum(decode(jcfx,'上行',pqi*cd,0)) pqi_up,sum(decode(jcfx,'上行',cd,0)) cd2_up,
              sum(decode(jcfx,'下行',pqi*cd,0)) pqi_down,sum(decode(jcfx,'下行',cd,0)) cd2_down,
              sum(decode(jcfx,'双向',pci*cd,0)) pci_sx,sum(decode(jcfx,'双向',cd,0)) cd3_sx,
              sum(decode(jcfx,'上行',pci*cd,0)) pci_up,sum(decode(jcfx,'上行',cd,0)) cd3_up,
              sum(decode(jcfx,'下行',pci*cd,0)) pci_down,sum(decode(jcfx,'下行',cd,0)) cd3_down,
              sum(decode(jcfx,'双向',rqi*cd,0)) rqi_sx,sum(decode(jcfx,'双向',cd,0)) cd4_sx,
              sum(decode(jcfx,'上行',rqi*cd,0)) rqi_up,sum(decode(jcfx,'上行',cd,0)) cd4_up,
              sum(decode(jcfx,'下行',rqi*cd,0)) rqi_down,sum(decode(jcfx,'下行',cd,0)) cd4_down,
              sum(decode(jcfx,'双向',sci*cd,0)) sci_sx,sum(decode(jcfx,'双向',cd,0)) cd5_sx,
              sum(decode(jcfx,'上行',sci*cd,0)) sci_up,sum(decode(jcfx,'上行',cd,0)) cd5_up,
              sum(decode(jcfx,'下行',sci*cd,0)) sci_down,sum(decode(jcfx,'下行',cd,0)) cd5_down,
              sum(decode(jcfx,'双向',bci*cd,0)) bci_sx,sum(decode(jcfx,'双向',cd,0)) cd6_sx,
              sum(decode(jcfx,'上行',bci*cd,0)) bci_up,sum(decode(jcfx,'上行',cd,0)) cd6_up,
              sum(decode(jcfx,'下行',bci*cd,0)) bci_down,sum(decode(jcfx,'下行',cd,0)) cd6_down,
              sum(decode(jcfx,'双向',tci*cd,0)) tci_sx,sum(decode(jcfx,'双向',cd,0)) cd7_sx,
              sum(decode(jcfx,'上行',tci*cd,0)) tci_up,sum(decode(jcfx,'上行',cd,0)) cd7_up,
              sum(decode(jcfx,'下行',tci*cd,0)) tci_down,sum(decode(jcfx,'下行',cd,0)) cd7_down,
              sum(mqi*cd)/sum(cd) mqi,sum(pqi*cd)/sum(cd) pqi,sum(pci*cd)/sum(cd) pci,
              sum(rqi*cd)/sum(rqi) rqi,sum(sci*cd)/sum(cd) sci,sum(bci*cd)/sum(cd) bci,sum(tci*cd)/sum(cd) tci
       from(
        select abs(zdzh-qdzh) cd,m.tbnf,t.*  
        from lkpd_mxb_data_2014 t left join lkpd_mxb2014 m on t.mxb_id=m.id        
       where lxbh = #{lkmxb.lxbh}
              <if test="lkmxb.jsdj != null and  lkmxb.jsdj != ''">
				and jsdj = #{lkmxb.jsdj}
			  </if> 
			  <if test="lkmxb.qdzh != null and  lkmxb.qdzh != ''">
				and to_number(zdzh) >= to_number(#{lkmxb.qdzh})
			  </if> 
			  <if test="lkmxb.zdzh != null and  lkmxb.zdzh != ''">
				and to_number(qdzh) &lt;= to_number(#{lkmxb.zdzh})
			  </if> 
			  <if test="lkmxb.tbnf != null and  lkmxb.tbnf != ''">
				 and (m.tbnf=#{lkmxb.tbnf} or m.tbnf=#{lkmxb.tbnf}+1) 
			  </if>
           ) a
        group by tbnf ) b 
	</select>
	
</mapper>
