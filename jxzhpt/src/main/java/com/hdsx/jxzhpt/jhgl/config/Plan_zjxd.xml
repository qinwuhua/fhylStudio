<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.plan_zjxd">
	<select id="queryZjxdByXmId" parameterType="string" resultType="plan_zjxd">
		select p.*,nvl(p.btzzj,0)+nvl(p.rys,0)+nvl(p.dk,0)+nvl(p.jl,0)+nvl(p.gz,0)+nvl(p.sz,0)+nvl(p.zq,0) zbz from plan_zjxd p where xmid=#{id} order by xdnf
	</select>
	<select id="queryZjxdSumByXmid" parameterType="string" resultType="plan_zjxd">
		select count(z.xmid) as xmid,nvl(sum(z.xdzj),0) as xdzj,
		nvl(sum(z.btzzj),0) as btzzj,nvl(sum(z.stz),0) as stz from plan_zjxd z 
		where z.xmid=#{id} group by z.xmid
	</select>
	<select id="queryGydwmcById" parameterType="string" resultType="string">
		select name from xtgl_department where id=#{id}
	</select>
	<select id="queryZjxdCount" parameterType="string" resultType="int">
		select count(*) from plan_zjxd where xmid=#{id}
	</select>
	<select id="queryZjxdById" parameterType="string" resultType="plan_zjxd">
		select * from plan_zjxd where id=#{id}
	</select>
	<select id="queryZjxdExistById" parameterType="string" resultType="int">
		select count(*) from plan_zjxd where xmid=#{id}
	</select>
	<insert id="addZjxd" parameterType="plan_zjxd">
		insert into plan_zjxd (id
		<if test="xmid!=null">,xmid</if>
		<if test="xdnf!=null">,xdnf</if>
		<if test="xdzj!=null">,xdzj</if>
		<if test="sfzj!=null">,sfzj</if>
		<if test="tbdw!=null">,tbdw</if>
		<if test="tbtime!=null">,tbtime</if>
		<if test="btzzj!=null">,btzzj</if>
		<if test="stz!=null">,stz</if>
		<if test="jhxdwh!=null">,jhxdwh</if>
		<if test="ztz != null">,ztz</if>
		<if test="dk != null">,dk</if>
		<if test="stc != null">,stc</if>
		) 
		values (SYS_GUID()
		<if test="xmid!=null">,#{xmid}</if>
		<if test="xdnf!=null">,#{xdnf}</if>
		<if test="xdzj!=null">,#{xdzj}</if>
		<if test="sfzj!=null">,#{sfzj}</if>
		<if test="tbdw!=null">,#{tbdw}</if>
		<if test="tbtime!=null">,#{tbtime}</if>
		<if test="btzzj!=null">,#{btzzj}</if>
		<if test="stz!=null">,#{stz}</if>
		<if test="jhxdwh!=null">,#{jhxdwh}</if>
		<if test="ztz != null">,#{ztz}</if>
		<if test="dk != null">,#{dk}</if>
		<if test="stc != null">,#{stc}</if>)
	</insert>
	<insert id="addxZjxd" parameterType="plan_zjxd">
		insert into plan_zjxd (id
		<if test="xmid!=null">,xmid</if>
		<if test="xdnf!=null">,xdnf</if>
		<if test="xdzj!=null">,xdzj</if>
		<if test="sfzj!=null">,sfzj</if>
		<if test="tbdw!=null">,tbdw</if>
		<if test="tbtime!=null">,tbtime</if>
		<if test="btzzj!=null">,btzzj</if>
		<if test="stz!=null">,stz</if>
		<if test="jhxdwh!=null">,jhxdwh</if>
		<if test="yhdk!=null">,yhdk</if>
		<if test="ztz!=null">,ztz</if>
		<if test="gz!=null">,gz</if>
		<if test="sz!=null">,sz</if>
		<if test="gzzq!=null">,gzzq</if>
		<if test="szzq!=null">,szzq</if>
		) 
		values (SYS_GUID()
		<if test="xmid!=null">,#{xmid}</if>
		<if test="xdnf!=null">,#{xdnf}</if>
		<if test="xdzj!=null">,#{xdzj}</if>
		<if test="sfzj!=null">,#{sfzj}</if>
		<if test="tbdw!=null">,#{tbdw}</if>
		<if test="tbtime!=null">,#{tbtime}</if>
		<if test="btzzj!=null">,#{btzzj}</if>
		<if test="stz!=null">,#{stz}</if>
		<if test="jhxdwh!=null">,#{jhxdwh}</if>
		<if test="yhdk!=null">,#{yhdk}</if>
		<if test="ztz!=null">,#{ztz}</if>
		<if test="gz!=null">,#{gz}</if>
		<if test="sz!=null">,#{sz}</if>
		<if test="gzzq!=null">,#{gzzq}</if>
		<if test="szzq!=null">,#{szzq}</if>
		)
	</insert>
	
	
	<insert id="insertBatch" parameterType="plan_zjxd">
		insert into plan_zjxd (id<if test="xmid!=null">,xmid</if>
		<if test="xdnf!=null">,xdnf</if>
		<if test="xdzj!=null">,xdzj</if>
		<if test="sfzj!=null">,sfzj</if>
		<if test="tbdw!=null">,tbdw</if>
		<if test="tbtime!=null">,tbtime</if>
		<if test="btzzj!=null">,btzzj</if>
		<if test="stz!=null">,stz</if>
		<if test="yhdk !=null">,yhdk</if>
		<if test="gz !=null">,gz</if>
		<if test="sz !=null">,sz</if>
		<if test="gzzq !=null">,gzzq</if>
		<if test="szzq !=null">,szzq</if>
		<if test="ztz !=null">,ztz</if>
		<if test="jhxdwh!=null">,jhxdwh</if>) 
		values (SYS_GUID()<if test="xmid!=null">,#{xmid}</if>
		<if test="xdnf!=null">,#{xdnf}</if>
		<if test="xdzj!=null">,#{xdzj}</if>
		<if test="sfzj!=null">,#{sfzj}</if>
		<if test="tbdw!=null">,#{tbdw}</if>
		<if test="tbtime!=null">,#{tbtime}</if>
		<if test="btzzj!=null">,#{btzzj}</if>
		<if test="stz!=null">,#{stz}</if>
		<if test="yhdk !=null">,#{yhdk}</if>
		<if test="gz !=null">,#{gz}</if>
		<if test="sz !=null">,#{sz}</if>
		<if test="gzzq !=null">,#{gzzq}</if>
		<if test="szzq !=null">,#{szzq}</if>
		<if test="ztz !=null">,#{ztz}</if>
		<if test="jhxdwh!=null">,#{jhxdwh}</if>)
	</insert>
	<update id="editZjxd" parameterType="plan_zjxd">
		update plan_zjxd set 
			<if test="xdnf!=null and xdnf!=''">xdnf=#{xdnf},</if>
			<if test="xdzj!=null and xdzj!=''">xdzj=#{xdzj},</if>
			<if test="btzzj!=null and btzzj!=''">btzzj=#{btzzj},</if>
			<if test="stz!=null and stz!=''">stz=#{stz},</if>
			<if test="jhxdwh!=null and jhxdwh!=''">jhxdwh=#{jhxdwh},</if>
			<if test="sfzj!=null and sfzj!=''">sfzj=#{sfzj},</if>
			<if test="tbdw!=null and tbdw!=''">tbdw=#{tbdw},</if>
			<if test="tbtime!=null and tbtime!=''">tbtime=#{tbtime},</if>
			<if test="ztz !=null and ztz !=''">ztz=#{ztz},</if>
			<if test="stc !=null and stc !=''">stc=#{stc},</if>
			<if test="dk !=null and dk !=''">dk=#{dk},</if>
			id=#{id}
		where id=#{id}
	</update>
	<update id="editxZjxd" parameterType="plan_zjxd">
		update plan_zjxd set 
			<if test="xdnf!=null and xdnf!=''">xdnf=#{xdnf},</if>
			<if test="xdzj!=null and xdzj!=''">xdzj=#{xdzj},</if>
			<if test="btzzj!=null and btzzj!=''">btzzj=#{btzzj},</if>
			<if test="stz!=null and stz!=''">stz=#{stz},</if>
			<if test="yhdk!=null and yhdk!=''">yhdk=#{yhdk},</if>
			<if test="gz!=null and gz!=''">gz=#{gz},</if>
			<if test="sz!=null and sz!=''">sz=#{sz},</if>
			<if test="gzzq!=null and gzzq!=''">gzzq=#{gzzq},</if>
			<if test="szzq!=null and szzq!=''">szzq=#{szzq},</if>
			<if test="ztz !=null and ztz !=''">ztz=#{ztz},</if>
			<if test="jhxdwh!=null and jhxdwh!=''">jhxdwh=#{jhxdwh},</if>
			<if test="sfzj!=null and sfzj!=''">sfzj=#{sfzj},</if>
			<if test="tbdw!=null and tbdw!=''">tbdw=#{tbdw},</if>
			<if test="tbtime!=null and tbtime!=''">tbtime=#{tbtime},</if>
			id=#{id}
		where id=#{id}
	</update>
	<delete id="dropZjxdById" parameterType="string">
		delete from plan_zjxd zj where zj.id=#{id}
	</delete>
	<insert id="insertZjzj" parameterType="plan_zjzj">
		insert into plan_zjzj (id,planid,nf,bbzje,ztz,stz) 
		values(sys_guid(),#{planId},#{nf},#{bbzje},#{ztz},#{stz})
	</insert>
	<insert id="insertHslyZjzj" parameterType="plan_hslyzjzj">
		insert into plan_hslyzjzj (id, planid, jhnf, ztz, zytzcgs, dfzc, gndk, lywz, zyjsnr, xzscnl) 
		values(sys_guid(),#{planid},#{jhnf},#{ztz},#{zytzcgs},#{dfzc},#{gndk},#{lywz},#{zyjsnr},#{xzscnl})
	</insert>
	<select id="queryTsdqByXzqh" parameterType="treenode" resultType="treenode">
		select t.name as name from xtgl_xzqhtsdq s left join xtgl_tsdq t on s.parent=t.id where s.xzqhdm =#{id}
	</select>
	<select id="queryZjzjByXmid" parameterType="plan_zjzj" resultType="plan_zjzj">
		select * from plan_zjzj z where z.planid=#{planId}
	</select>
</mapper>